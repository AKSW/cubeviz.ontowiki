var CubeViz_ConfigurationLink=(function(){function c(){}c.saveData=function a(d,l,m,f,h,k,g){if(typeof g==="undefined"){g=false}var j=$.ajaxSetup();var e=$.support.cors;var i=JSON.stringify(h);$.ajaxSetup({async:true,cache:false,type:"POST"});$.support.cors=true;$.ajax({url:d+"savecontenttofile/",data:{hash:f,modelIri:m,serviceUrl:l,stringifiedContent:i,type:"data",useObservations:true===g?"true":"false"}}).error(function(p,n,o){$.ajaxSetup(j);$.support.cors=e;throw new Error("save error: "+p.responseText)}).done(function(n){$.ajaxSetup(j);$.support.cors=e;k()})};c.saveUI=function b(d,k,l,f,g,j){var i=$.ajaxSetup();var e=$.support.cors;var h=JSON.stringify(g);$.ajaxSetup({async:true,cache:false,type:"POST"});$.support.cors=true;$.ajax({url:d+"savecontenttofile/",data:{hash:f,modelIri:l,stringifiedContent:JSON.stringify(g),type:"ui"}}).error(function(o,m,n){$.ajaxSetup(i);$.support.cors=e;throw new Error("save error: "+o.responseText)}).done(function(m){$.ajaxSetup(i);$.support.cors=e;j()})};return c})();var CubeViz_Collection=(function(){function a(b){this.reset(b)}a.prototype.add=function(c,d,b){if(typeof b==="undefined"){b=false}if(false===b){if(true===_.isUndefined(c[this.idKey])){throw new Error("Key "+this.idKey+" in element not set!");return this}if(true===_.isUndefined(this.get(c[this.idKey]))){this._.push(c)}else{if((false===_.isUndefined(d)&&false===_.isUndefined(d.merge)&&d.merge==true)){this.remove(c[this.idKey]);this._.push(c)}}}else{this._.push(c)}return this};a.prototype.addList=function(c){var b=this;if(true==_.isArray(c)){_.each(c,function(d){b.add(d,null,true)})}else{if(true==_.isObject(c)){this.addList(_.values(c))}}return b};a.prototype.each=function(b){_.each(this._,b);return this};a.prototype.exists=function(b){return false===_.isUndefined(this.get(b))};a.prototype.get=function(d){var b=this;var c=_.filter(this._,function(e){if(e[b.idKey]==d){return true}else{return false}});return 1==c.length?c[0]:undefined};a.prototype.getFirst=function(){return _.first(this._)};a.prototype.getElementsValues=function(c){var b=new a();this.each(function(d){if(false===_.isUndefined(d[c])&&false===_.isNull(d[c])){b.add(d[c],null,true)}});return b};a.prototype.remove=function(c){var b=this;this._=_.reject(this._,function(d){return d[b.idKey]==c});return this};a.prototype.reset=function(b){this.idKey=undefined===b?(undefined===this.idKey?"id":this.idKey):b;this._=[];return this};a.prototype.size=function(){return _.size(this._)};a.prototype.sortAscendingBy=function(g){var f="";var e="";var j="";var i="";var h=false===_.isUndefined(g)?g:this.idKey;this._.sort(function(d,c){try{try{j=parseFloat(d[h]);i=parseFloat(c[h]);if(true===_.isNaN(j)||true===_.isNaN(i)){throw new Error()}}catch(k){j=d[h].toUpperCase();i=c[h].toUpperCase()}return(j<i)?-1:(j>i)?1:0}catch(l){}});return this};a.prototype.toObject=function(){var b=0;var c={};_.each(this._,function(d){c[b++]=d});return c};return a})();var CubeViz_Visualization=(function(){function CubeViz_Visualization(){this.name="CubeViz_Visualization";this.supportedClassNames=[]}CubeViz_Visualization.prototype.getName=function(){return this.name};CubeViz_Visualization.prototype.getSupportedClassNames=function(){return this.supportedClassNames};CubeViz_Visualization.prototype.isResponsibleFor=function(className){return _.contains(this.getSupportedClassNames(),className)};CubeViz_Visualization.prototype.load=function(c){if(true===this.isResponsibleFor(c)){var chart=null;eval("chart = new "+c+"();");return chart}else{throw new Error("Invalid c ("+c+") given!")}};CubeViz_Visualization.prototype.render=function(chart){return null};return CubeViz_Visualization})();var CubeViz_View_Abstract=(function(){function a(d,b,c){this.app=c;this.attachedTo=b;this.autostart=false;this.collection=new CubeViz_Collection();this.id=d||"view"}a.prototype.bindGlobalEvents=function(b){this.app.bindGlobalEvents(b,this);return this};a.prototype.bindUserInterfaceEvents=function(e){if(true===_.isUndefined(e)||0==_.size(e)){return}var d="";var b="";var c=this;_.each(e,function(g,f){if(false===_.isFunction(g)){g=c[g]}if(!g){throw new Error("Method "+g+" does not exist")}d=f.substr(0,f.indexOf(" "));b=f.substr(f.indexOf(" ")+1);$(b).on(d,$.proxy(g,c))})};a.prototype.destroy=function(){var b=$(this.attachedTo);b.off();if(true===b.is("div")){b.empty()}else{if(true===b.is("select")){b.find("option").remove()}}this.collection.reset();return this};a.prototype.initialize=function(){};a.prototype.triggerGlobalEvent=function(b,c){this.app.triggerEvent(b,c);return this};return a})();var CubeViz_View_Application=(function(){function CubeViz_View_Application(){this._viewInstances=new CubeViz_Collection();this._eventHandlers=new CubeViz_Collection();this._={}}CubeViz_View_Application.prototype.add=function(id,attachedTo,merge){var options=true===merge?{merge:true}:undefined;var viewObj={alreadyRendered:false,attachedTo:attachedTo,id:id,instance:null};eval("viewObj.instance = new "+id+'("'+attachedTo+'", this);');this._viewInstances.add(viewObj,options);return this};CubeViz_View_Application.prototype.bindGlobalEvents=function(events,callee){if(true===_.isUndefined(events)||0==_.size(events)){return this}var self=this;_.each(events,function(event){$(self).on(event.name,$.proxy(event.handler,callee))});return this};CubeViz_View_Application.prototype.destroyView=function(id){this._viewInstances.get(id).instance.destroy();return this};CubeViz_View_Application.prototype.get=function(id){return this._viewInstances.get(id)};CubeViz_View_Application.prototype.getDataCopy=function(){var backup=[this._.generatedVisualization];this._.generatedVisualization=undefined;var result=$.parseJSON(JSON.stringify(this._));this._.generatedVisualization=backup[1];return result};CubeViz_View_Application.prototype.remove=function(id){this._viewInstances.remove(id);return this};CubeViz_View_Application.prototype.renderAll=function(){var self=this;_.each(this._viewInstances._,function(view){self.renderView(view.id,view.attachedTo)});return this};CubeViz_View_Application.prototype.renderView=function(id,attachedTo){this.add(id,attachedTo).destroyView(id).get(id).instance.initialize();return this};CubeViz_View_Application.prototype.reset=function(){$(this).off();var self=this;_.each(this._viewInstances._,function(view){self.destroyView(view.id).add(view.id,view.attachedTo,true)});return this};CubeViz_View_Application.prototype.restoreDataCopy=function(copy){this._=$.parseJSON(JSON.stringify(copy));return this};CubeViz_View_Application.prototype.triggerEvent=function(eventName,data){$(this).trigger(eventName,[data]);return this};CubeViz_View_Application.prototype.unbindEvent=function(eventName){$(this).off(eventName);return this};return CubeViz_View_Application})();var CubeViz_View_Helper=(function(){function f(){}f.attachDialogTo=function k(p,o){var n={};var o=o||{};n.autoOpen=o.autoOpen||false;n.closeOnEscape=o.closeOnEscape||false;n.draggable=o.draggable||false;n.height=o.height||"auto";n.hide=o.hide||"slow";n.modal=o.modal||true;n.overlay=o.overlay||{"background-color":"#FFFFFF",opacity:0.5};n.resizable=o.resizable||false;n.show=o.show||"slow";n.width=o.width||"700";if(true===_.isUndefined(o.showCross)||false===o.showCross){n.open=function(q,r){$(".ui-dialog-titlebar-close",$(this).parent()).hide()}}p.dialog(n);p.data("hasDialog",true)};f.closeDialog=function e(n){n.dialog("close");n.data("isDialogOpen",false)};f.destroyDialog=function m(n){n.dialog("destroy");n.data("isDialogOpen",false)};f.hideCloseAndUpdateSpinner=function j(n){$(n.find(".cubeviz-dataSelectionModule-closeUpdateSpinner").first()).hide()};f.hideLeftSidebarSpinner=function c(){$("#cubeviz-dataSelectionModule-spinnerIcon").hide();$("#cubeviz-dataSelectionModule-spinnerText").hide();$("#cubeviz-dataSelectionModule-spinner").fadeOut("slow",function(){$("#cubeviz-dataSelectionModule-dataSelection").fadeIn("slow")})};f.openDialog=function d(n){n.dialog("open");n.data("isDialogOpen",true);$(".ui-widget-overlay").css("height",2*screen.height)};f.showCloseAndUpdateSpinner=function i(n){$(n.find(".cubeviz-dataSelectionModule-closeUpdateSpinner").first()).show()};f.showLeftSidebarSpinner=function b(){$("#cubeviz-dataSelectionModule-spinnerIcon").show();$("#cubeviz-dataSelectionModule-spinnerText").show();$("#cubeviz-dataSelectionModule-dataSelection").fadeOut("slow",function(){$("#cubeviz-dataSelectionModule-spinner").fadeIn("slow").show()})};f.sortLiItemsByAlphabet=function h(r){var o="";var n="";var q={};var p=[];r.sort(function(t,s){t=$(t).text().toUpperCase();s=$(s).text().toUpperCase();return(t<s)?-1:(t>s)?1:0});_.each(r,function(s){q=$(s).data("data");s=$(s).clone();$(s).data("data",q);p.push(s)});return p};f.sortLiItemsByCheckStatus=function l(q){var p={};var n=[];var o=[];_.each(q,function(r){if($($(r).children().first()).is(":checked")){p=$(r).data("data");r=$(r).clone();$(r).data("data",p);o.push(r)}else{n.push(r)}});_.each(n,function(r){p=$(r).data("data");r=$(r).clone();$(r).data("data",p);o.push(r)});return o};f.sortLiItemsByObservationCount=function a(s,u,t){var n="";var r=[];var p=[];var q=0;var o=[];_.each(s,function(v){n=$($(v).children().first()).val();q=0;_.each(t,function(w){if(n===w[u][0].value){++q}});$(v).data("observationCount",q);if(0<q){o.push($(v).clone())}else{p.push(v)}});o.sort(function(w,v){w=$(w).data("observationCount");v=$(v).data("observationCount");return(w<v)?1:(w>v)?-1:0});_.each(p,function(v){o.push($(v).clone())});return o};f.tplReplace=function g(n,p){if(true===_.isUndefined(p)){return n}var o=_.keys(p);_.each(o,function(q){n=n.replace("[["+q+"]]",_.str.trim(p[q]))});return _.str.trim(n)};return f})();var CubeViz_Visualization_Controller=(function(){function CubeViz_Visualization_Controller(){}CubeViz_Visualization_Controller.getColor=function getColor(variable){var color="#FFFFFF";if(true===_.isString(variable)||true===_.isNumber(variable)){color=""+CryptoJS.MD5(variable);color="#"+color.substr((color.length-6),6)}else{if(false===_.isUndefined(variable)){color=JSON.stringify(variable);color="#"+color.substr((color.length-6),6)}}return color};CubeViz_Visualization_Controller.getFromChartConfigByClass=function getFromChartConfigByClass(className,charts){var result=null;_.each(charts,function(chart){if(true===_.isNull(result)){if(className==chart.className){result=chart}}});return result};CubeViz_Visualization_Controller.getMultipleDimensions=function getMultipleDimensions(selectedComponentDimensions){var multipleDimensions=[];_.each(selectedComponentDimensions,function(selectedDimension){if(2<=_.keys(selectedDimension.__cv_elements).length){multipleDimensions.push(selectedDimension)}});return multipleDimensions};CubeViz_Visualization_Controller.getObjectValueByKeyString=function getObjectValueByKeyString(keyString,objToAccess){var call="objToAccess";var result=undefined;try{_.each(keyString.split("."),function(key){call+="."+key});eval("result = "+call)}catch(ex){}return result};CubeViz_Visualization_Controller.getOneElementDimensions=function getOneElementDimensions(selectedComponentDimensions){var oneElementDimensions=[];_.each(selectedComponentDimensions,function(selectedDimension){if(1==_.keys(selectedDimension.__cv_elements).length){oneElementDimensions.push(selectedDimension)}});return oneElementDimensions};CubeViz_Visualization_Controller.getVisualizationType=function getVisualizationType(className){var hC=new CubeViz_Visualization_HighCharts();var d3js=new CubeViz_Visualization_D3js();if(true===hC.isResponsibleFor(className)){return hC.getName()}else{if(true===d3js.isResponsibleFor(className)){return d3js.getName()}else{throw new Error("Unknown className "+className)}}};CubeViz_Visualization_Controller.linkify=function linkify(inputText){var emailAddressPattern=/\w+@[a-zA-Z_]+?(?:\.[a-zA-Z]{2,6})+/gim;var pseudoUrlPattern=/(^|[^\/])(www\.[\S]+(\b|$))/gim;var urlPattern=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim;return inputText.replace(urlPattern,'<a href="$&" target="_blank">$&</a>').replace(pseudoUrlPattern,'$1<a href="http://$2" target="_blank">$2</a>').replace(emailAddressPattern,'<a href="mailto:$&">$&</a>')};CubeViz_Visualization_Controller.getDefaultChartConfig=function getDefaultChartConfig(chartConfig,numberOfMultipleDimensions){return{className:chartConfig[numberOfMultipleDimensions].charts[0].className,chartConfig:chartConfig[numberOfMultipleDimensions].charts[0]}};CubeViz_Visualization_Controller.setChartConfigClassEntry=function setChartConfigClassEntry(className,charts,newValue){for(var i in charts){if(className==charts[i].className){charts[i]=newValue}}};CubeViz_Visualization_Controller.updateVisualizationSettings=function updateVisualizationSettings(menuItemValues,visualizationSetting,chartConfigEntryDefaultConfig){var call="";var optionKey="";var optionVal="";var updatedSetting=visualizationSetting||{};if(0===_.keys(updatedSetting).length){updatedSetting=chartConfigEntryDefaultConfig}updatedSetting=$.parseJSON(JSON.stringify(updatedSetting));_.each(menuItemValues,function(menuItemValue){optionKey=$(menuItemValue).data("key");optionVal=$(menuItemValue).val();if(true===_.isUndefined(optionKey)){return}call="updatedSetting";_.each(optionKey.split("."),function(key){call+="."+key;eval(call+" = "+call+" || {};")});eval(call+" = optionVal;")});return updatedSetting};return CubeViz_Visualization_Controller})();var __extends=this.__extends||function(e,a){function c(){this.constructor=e}c.prototype=a.prototype;e.prototype=new c()};var CubeViz_Visualization_D3js=(function(b){__extends(a,b);function a(){b.call(this);this.name="D3js";this.supportedClassNames=["CubeViz_Visualization_D3js_CirclePacking","CubeViz_Visualization_D3js_CirclePackingForClusters"]}a.prototype.render=function(c){c.getRenderResult()};return a})(CubeViz_Visualization);var CubeViz_Visualization_D3js_CirclePacking=(function(){function a(){this.chartConfig={};this.generatedData={name:"",children:[]}}a.prototype.computeData=function(h,g,b){var e=[];var f=[];var c=this;var d=null;_.each(h,function(i){if(false===DataCube_Observation.isActive(i)){return}f=[];e=[{name:"",size:""}];_.each(g,function(j){_.each(j.__cv_elements,function(k){if(k.__cv_uri===i[j["http://purl.org/linked-data/cube#dimension"]]){f.push(k.__cv_niceLabel)}})});e[0].name=f.join(" - ");e[0].size=DataCube_Observation.parseValue(i,b["http://purl.org/linked-data/cube#measure"]);c.generatedData.children.push({name:i.__cv_niceLabel,children:e})})};a.prototype.init=function(e,g,c,f,h,b,d){this.chartConfig=e;this.computeData(g,f,b);return this};a.prototype.getRenderResult=function(){var d=960;var c=d3.layout.pack().size([d-4,d-4]).value(function(f){return f.size});var b=d3.select("#cubeviz-index-visualization").append("svg").attr("width",d).attr("height",d).append("g").attr("transform","translate(2,2)");var e=b.datum(this.generatedData).selectAll(".node").data(c.nodes).enter().append("g").attr("class",function(f){return f.children?"node":"cubeviz-visualization-d3js-circleLeaf node"}).attr("transform",function(f){return"translate("+f.x+","+f.y+")"});e.append("title").text(function(f){return f.name+(f.children?"":": "+f.size)});e.append("circle").attr("r",function(f){return f.r});e.filter(function(f){return !f.children}).append("text").attr("dy",".3em").style("fill",this.chartConfig.style.circle.fill).style("font-size",this.chartConfig.style.circle["font-size"]).style("font-weight",this.chartConfig.style.circle["font-weight"]).style("text-anchor",this.chartConfig.style.circle["text-anchor"]).text(function(f){return f.name.substring(0,f.r*0.3)});return b};return a})();var CubeViz_Visualization_D3js_CirclePackingForClusters=(function(){function a(){this.chartConfig={};this.generatedData={name:"",children:[]}}a.prototype.computeData=function(g,f,c){var b={};var d=this;var e=null;_.each(f[0].__cv_elements,function(h){b={name:h.__cv_niceLabel,children:[]};_.each(g,function(i){if(i[f[0]["http://purl.org/linked-data/cube#dimension"]]==h.__cv_uri){e=DataCube_Observation.parseValue(i,c["http://purl.org/linked-data/cube#measure"]);b.children.push({name:_.str.numberFormat(e,4,",","."),size:e})}});d.generatedData.children.push(b)})};a.prototype.init=function(e,g,c,f,h,b,d){this.chartConfig=e;this.computeData(g,f,b);return this};a.prototype.getRenderResult=function(){var d=960;var c=d3.layout.pack().size([d-4,d-4]).value(function(f){return f.size});var b=d3.select("#cubeviz-index-visualization").append("svg").attr("width",d).attr("height",d).append("g").attr("transform","translate(2,2)");var e=b.datum(this.generatedData).selectAll(".node").data(c.nodes).enter().append("g").attr("class",function(f){return f.children?"node":"cubeviz-visualization-d3js-circleLeaf node"}).attr("transform",function(f){return"translate("+f.x+","+f.y+")"});e.append("title").text(function(f){return _.str.numberFormat(f.size,4,",",".")});e.append("circle").attr("r",function(f){return f.r});e.filter(function(f){return !f.children}).append("text").attr("dy",".3em").style("fill",this.chartConfig.style.circle.fill).style("font-size",this.chartConfig.style.circle["font-size"]).style("font-weight",this.chartConfig.style.circle["font-weight"]).style("text-anchor",this.chartConfig.style.circle["text-anchor"]).text(function(f){return f.name.substring(0,f.r*0.3)});return b};return a})();var CubeViz_Visualization_HighCharts=(function(b){__extends(a,b);function a(){b.call(this);this.name="HighCharts";this.supportedClassNames=["CubeViz_Visualization_HighCharts_Area","CubeViz_Visualization_HighCharts_AreaSpline","CubeViz_Visualization_HighCharts_Bar","CubeViz_Visualization_HighCharts_Column","CubeViz_Visualization_HighCharts_Line","CubeViz_Visualization_HighCharts_Pie","CubeViz_Visualization_HighCharts_Polar","CubeViz_Visualization_HighCharts_Spline"]}a.prototype.render=function(c){return new Highcharts.Chart(c.getRenderResult())};return a})(CubeViz_Visualization);var CubeViz_Visualization_HighCharts_Chart=(function(){function a(){}a.prototype.handleTwoDimensionsWithAtLeastOneDimensionElement=function(j,o,k,c,n,l){var q={};var h=0;var p=this;var r=l.getAxesElements(o);_.each(r,function(i){p.chartConfig.xAxis.categories.push(i.self.__cv_niceLabel);q[i.self.__cv_uri]=h++});var b=[];_.each(j,function(i){b.push(i["http://purl.org/linked-data/cube#dimension"])});var g={};var f=l.getAxesElements(k);var m="";var d={};var e=null;p.chartConfig.series=[];_.each(f,function(i){g={color:CubeViz_Visualization_Controller.getColor(i.self.__cv_uri),data:[],name:i.self.__cv_niceLabel,__cv_uri:i.self.__cv_uri};for(h=0;h<_.size(p.chartConfig.xAxis.categories);++h){g.data.push(null)}_.each(i.observations,function(s){if(false===DataCube_Observation.isActive(s)){return}if((false===_.isNull(c)&&(true===_.isNull(s[c])||true===_.isUndefined(s[c])))&&c!==s["http://purl.org/linked-data/cube#attribute"]){return}m="";_.each(b,function(t){m+=s[t]});if(true===_.isUndefined(d[m])){d[m]=true}else{return}if(false===_.isUndefined(s.__cv_temporaryNewValue)){e=s.__cv_temporaryNewValue}else{e=s[n]}if(false===_.isUndefined(s[n])){g.data[q[s[o]]]=parseFloat(e)}else{g.data[q[s[o]]]=null}});if(0==_.size(g.data)){}else{p.chartConfig.series.push(g)}})};a.prototype.handleOnlyOneElementDimension=function(e,b,i,g){var j=this;var f=null;var h=[];var d=g.getAxesElements(e);var c=null;this.chartConfig.xAxis.categories=["."];_.each(d,function(k){f=k.observations[_.keys(k.observations)[0]];if(false===_.isNull(b)&&(true===_.isNull(f[b])||true===_.isUndefined(f[b]))){return}if(false===_.isUndefined(f.__cv_temporaryNewValue)){c=f.__cv_temporaryNewValue}else{c=f[i]}j.chartConfig.series.push({name:k.self.__cv_niceLabel,data:[c]})})};a.prototype.handleOnlyOneMultipleDimension=function(j,b,i,c,k){var l=this;var d=null;var e=[];var m=c.sortAxis(j,"ascending").getAxesElements(j);var g=null;_.each(m,function(n){_.each(n.observations,function(o){if(false===DataCube_Observation.isActive(o)){return}g=DataCube_Observation.parseValue(o,i);if(true===_.isNull(g)){return}if(false===_.isNull(b)&&(true===_.isNull(o[b])||true===_.isUndefined(o[b]))){return}l.chartConfig.xAxis.categories.push(n.self.__cv_niceLabel);e.push(g)})});var f=".";if(0<_.size(k)){var h=[];_.each(k,function(n){h.push(n.__cv_elements[0].__cv_niceLabel)});f=h.join(" - ")}this.chartConfig.series=[{name:f,data:e}]};a.prototype.init=function(h,c,g,k,p,d,b){var m=0;var n=null;var j=null;var f=0;var l=new DataCube_Observation();var o=this;this.chartConfig=h;this.chartConfig.series=[];if(true===_.isUndefined(o.chartConfig.xAxis)){this.chartConfig.xAxis={categories:[]}}else{this.chartConfig.xAxis.categories=[]}this.chartConfig.title.text="";if(true===_.isUndefined(this.chartConfig.xAxis)){this.chartConfig.xAxis={title:{text:""}}}if(true===_.isUndefined(this.chartConfig.yAxis)){this.chartConfig.yAxis={title:{text:""}}}_.each(g,function(i){if(2>_.keys(i.__cv_elements).length){return}if(null==n){n=i["http://purl.org/linked-data/cube#dimension"]}else{j=i["http://purl.org/linked-data/cube#dimension"]}});if(null==j){_.each(g,function(i){if(1==_.keys(i.__cv_elements).length&&null==j){j=i["http://purl.org/linked-data/cube#dimension"]}})}this.chartConfig._cubeVizVisz=this.chartConfig._cubeVizVisz||{};if("true"==this.chartConfig._cubeVizVisz.doSwitchingAxes){var e=n;n=j;j=e}l.initialize(c,g,d["http://purl.org/linked-data/cube#measure"]);if(false===_.str.isBlank(n)&&false===_.str.isBlank(j)&&1<_.size(k)){this.handleTwoDimensionsWithAtLeastOneDimensionElement(g,n,j,b,d["http://purl.org/linked-data/cube#measure"],l)}else{if(false===_.str.isBlank(n)||false===_.str.isBlank(j)){if(false===_.str.isBlank(n)){this.handleOnlyOneMultipleDimension(n,b,d["http://purl.org/linked-data/cube#measure"],l,p)}else{this.handleOnlyOneElementDimension(j,b,d["http://purl.org/linked-data/cube#measure"],l)}}}this.setTooltip(g[Object.keys(g)[0]],d);return this};a.prototype.getRenderResult=function(){return this.chartConfig};a.prototype.setTooltip=function(d,b){var c=this;this.chartConfig.tooltip={formatter:function(){return d.__cv_niceLabel+": <b>"+this.x+"</b> <br/> "+b.__cv_niceLabel+": <b>"+_.str.numberFormat(this.y,4,",",".")+"</b>"}}};return a})();var CubeViz_Visualization_HighCharts_Area=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}return a})(CubeViz_Visualization_HighCharts_Chart);var CubeViz_Visualization_HighCharts_AreaSpline=(function(a){__extends(b,a);function b(){a.apply(this,arguments)}return b})(CubeViz_Visualization_HighCharts_Chart);var CubeViz_Visualization_HighCharts_Bar=(function(a){__extends(b,a);function b(){a.apply(this,arguments)}return b})(CubeViz_Visualization_HighCharts_Chart);var CubeViz_Visualization_HighCharts_Column=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}return a})(CubeViz_Visualization_HighCharts_Chart);var CubeViz_Visualization_HighCharts_Line=(function(a){__extends(b,a);function b(){a.apply(this,arguments)}return b})(CubeViz_Visualization_HighCharts_Chart);var CubeViz_Visualization_HighCharts_Pie=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.init=function(g,d,f,h,n,e,c){if(1<_.size(h)){throw new Error("Pie chart is only suitable for one dimension!");return}var l=h[_.keys(h)[0]]["http://purl.org/linked-data/cube#dimension"];var j="";var i=new DataCube_Observation();var m=this;var p=[];var k=null;this.chartConfig=g;this.chartConfig.colors=[];this.chartConfig.series=[];this.chartConfig.title.text="";if(true===_.isUndefined(this.chartConfig.xAxis)){this.chartConfig.xAxis={title:{text:""}}}if(true===_.isUndefined(this.chartConfig.yAxis)){this.chartConfig.yAxis={title:{text:""}}}i.initialize(d,f,e["http://purl.org/linked-data/cube#measure"]);var o=i.sortAxis(l,"ascending").getAxesElements(l);this.chartConfig.series.push({type:"pie",name:this.chartConfig.title.text,data:[]});_.each(o,function(q){_.each(q.observations,function(r){if(false===DataCube_Observation.isActive(r)){return}k=DataCube_Observation.parseValue(r,e["http://purl.org/linked-data/cube#measure"]);if(-1==$.inArray(q.self.__cv_niceLabel,p)){m.chartConfig.series[0].data.push([q.self.__cv_niceLabel,k]);m.chartConfig.colors.push(CubeViz_Visualization_Controller.getColor(q.self.__cv_uri));p.push(q.self.__cv_niceLabel)}else{return}})});return this};return a})(CubeViz_Visualization_HighCharts_Chart);var CubeViz_Visualization_HighCharts_Polar=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}return a})(CubeViz_Visualization_HighCharts_Chart);var CubeViz_Visualization_HighCharts_Spline=(function(a){__extends(b,a);function b(){a.apply(this,arguments)}return b})(CubeViz_Visualization_HighCharts_Chart);var DataCube_ClusteringDataCube=(function(){function e(){}e.stillUsedObservationUris=[];e.buildDataSets=function h(n,k,m){var o=k[0][0];var l=k[m-1][_.size(k[m-1])-1];return{0:{__cv_niceLabel:"Dataset for "+m+" cluster with overall values between "+o+" and "+l,"http://www.w3.org/2000/01/rdf-schema#label":"Dataset for "+m+" cluster with overall values between "+o+" and "+l,__cv_uri:n+"dataset",__cv_hashedUri:CryptoJS.MD5(n+"dataset")+"","http://purl.org/linked-data/cube#structure":n+"datastructuredefinition","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"http://purl.org/linked-data/cube#DataSet","http://purl.org/dc/terms/created":(new Date()).toString()}}};e.buildDataStructureDefinitions=function g(n,m){var l={0:{__cv_niceLabel:"Artifical Data Structure Definition","http://www.w3.org/2000/01/rdf-schema#label":"Artifical Data Structure Definition",__cv_description:"",__cv_uri:n+"dataStructureDefinition",__cv_hashedUri:CryptoJS.MD5(n+"dataStructureDefinition")+"","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"http://purl.org/linked-data/cube#DataStructureDefinition","http://purl.org/linked-data/cube#component":{0:n+"measure"},"http://purl.org/dc/terms/created":(new Date()).toString()}};var k=1;_.each(m,function(o){l[0]["http://purl.org/linked-data/cube#component"][k]=o.__cv_uri;++k});return l};e.buildDimensionElements=function a(r,n,m){var p={};var l=0;if("cluster"==m){_.each(n,function(s){if(0===_.size(s)){return}p[l]={__cv_niceLabel:"Cluster "+l,"http://www.w3.org/2000/01/rdf-schema#label":"Cluster "+l,__cv_uri:r+"cluster"+l,__cv_hashedUri:CryptoJS.MD5(r+"cluster"+l)+"","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":r+"clusterDimension"};++l})}else{if("position"==m){var o=$.parseJSON(JSON.stringify(n));o.sort(function(t,s){return _.size(t)<_.size(s)});var k="";var q=[];_.each(o,function(s,t){if(0==_.size(s)){return}_.each(s,function(v,u){if(0==u&&-1===$.inArray(u+" (first)",q)){k="0 (first)";q.push(k);p[l]={__cv_niceLabel:k,"http://www.w3.org/2000/01/rdf-schema#label":k,__cv_uri:r+"position"+l,__cv_hashedUri:CryptoJS.MD5(r+"position"+l)+"","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":r+"positionDimension"};++l}else{if(_.size(s)==(u+1)&&-1===$.inArray(u+" (last)",q)){k=u+" (last)";q.push(k);p[l]={__cv_niceLabel:k,"http://www.w3.org/2000/01/rdf-schema#label":k,__cv_uri:r+"position"+l,__cv_hashedUri:CryptoJS.MD5(r+"position"+l)+"","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":r+"positionDimension"};++l}else{if(0<u&&-1===$.inArray(u+"",q)){k=u+"";q.push(k);p[l]={__cv_niceLabel:k,"http://www.w3.org/2000/01/rdf-schema#label":k,__cv_uri:r+"position"+l,__cv_hashedUri:CryptoJS.MD5(r+"position"+l)+"","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":r+"positionDimension"};++l}else{}}}})})}}return p};e.buildDimensionsAndTheirComponentSpecifications=function b(o,m){var l=o+"componentSpecificationClusterDimension";var n={};var k=o+"componentSpecificationPositionDimension";n[l]={__cv_niceLabel:"Cluster Dimension","http://www.w3.org/2000/01/rdf-schema#label":"Cluster Dimension",__cv_description:"",__cv_uri:l,__cv_hashedUri:CryptoJS.MD5(l)+"",__cv_elements:e.buildDimensionElements(o,m,"cluster"),"http://purl.org/linked-data/cube#dimension":o+"clusterDimension","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"http://purl.org/linked-data/cube#ComponentSpecification","http://purl.org/dc/terms/created":(new Date()).toString()};n[k]={__cv_niceLabel:"Position Dimension","http://www.w3.org/2000/01/rdf-schema#label":"Position Dimension",__cv_description:"",__cv_uri:k,__cv_hashedUri:CryptoJS.MD5(k)+"",__cv_elements:e.buildDimensionElements(o,m,"position"),"http://purl.org/linked-data/cube#dimension":o+"positionDimension","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"http://purl.org/linked-data/cube#ComponentSpecification","http://purl.org/dc/terms/created":(new Date()).toString()};return n};e.buildMeasures=function j(k){return{0:{__cv_niceLabel:"Artifical Measure","http://www.w3.org/2000/01/rdf-schema#label":"Artifical Measure",__cv_description:"",__cv_uri:k+"componentSpecificationMeasure",__cv_hashedUri:CryptoJS.MD5(k+"componentSpecificationMeasure")+"","http://purl.org/linked-data/cube#measure":k+"measure","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"http://purl.org/linked-data/cube#ComponentSpecification","http://purl.org/dc/terms/created":(new Date()).toString()}}};e.buildObservations=function c(t,p,s,l,m){var o=0;var n=0;var k={};var r=this;var q=$.parseJSON(JSON.stringify(p));q.sort(function(v,u){return _.size(v)<_.size(u)});_.each(q,function(u,v){if(0===_.size(u)){return}_.each(u,function(x,w){k[o]={__cv_niceLabel:"Observation of cluster "+n,"http://www.w3.org/2000/01/rdf-schema#label":"Observation of cluster "+n,__cv_uri:t+"observation"+o,__cv_hashedUri:"c204871025866c6178c363948246c146",__cv_description:"","http://purl.org/linked-data/cube#dataSet":t+"dataset","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"http://purl.org/linked-data/cube#Observation"};k[o][t+"measure"]=x;k[o][t+"clusterDimension"]=t+"cluster"+n;k[o][t+"positionDimension"]=e.getPositionDimensionElement(t,p,v,w,x);k[o].__cv_sourceDataset=m;k[o].__cv_sourceObservation=e.getObservation(s,x,l);++o});++n});return k};e.create=function d(p,k,r,o,m,n){var l=DataCube_DataCubeMerger.getDefaultDataCubeObject();var q="";q=DataCube_DataCubeMerger.generateDataCubeUri(k,JSON.stringify(p));l.dataSets=e.buildDataSets(q,p,r);l.selectedDS=l.dataSets[0];l.components.dimensions=e.buildDimensionsAndTheirComponentSpecifications(q,p);l.selectedComponents.dimensions=l.components.dimensions;l.components.measures=e.buildMeasures(q);l.selectedComponents.measure=l.components.measures[0];l.dataStructureDefinitions=e.buildDataStructureDefinitions(q,l.selectedComponents.dimensions);l.selectedDSD=l.dataStructureDefinitions[0];e.stillUsedObservationUris=[];l.retrievedObservations=e.buildObservations(q,p,o,m,n);l.originalObservations=o;l.numberOfMultipleDimensions=_.size(CubeViz_Visualization_Controller.getMultipleDimensions(l.components.dimensions));l.numberOfOneElementDimensions=_.size(CubeViz_Visualization_Controller.getOneElementDimensions(l.components.dimensions));return l};e.getObservation=function f(o,n,m){var l=null;var k=this;o=$.parseJSON(JSON.stringify(o));_.each(o,function(p){p[m]=DataCube_Observation.parseValue(p,m);if(-1===$.inArray(p.__cv_uri,e.stillUsedObservationUris)&&p[m]===n){l=p;e.stillUsedObservationUris.push(p.__cv_uri)}});return l};e.getPositionDimensionElement=function i(u,n,s,t,o){var k="";var m=0;var q="";var r=$.parseJSON(JSON.stringify(n));var l="";var p=[];r.sort(function(w,v){return _.size(w)<_.size(v)});if(0==t){return u+"position0"}_.each(r,function(v,w){if(0==_.size(v)){return}_.each(v,function(y,x){l="";if(0==x&&-1===$.inArray(x+" (first)",p)){p.push("0 (first)");l=u+"position"+m;++m}else{if(_.size(v)==(x+1)&&-1===$.inArray(x+" (last)",p)){p.push(x+" (last)");l=u+"position"+m;++m}else{if(0<x&&-1===$.inArray(x+"",p)){p.push(x+"");l=u+"position"+m;++m}else{}}}if(s==w&&y==o){if(true===_.str.isBlank(l)){k=u+"position"+$.inArray(x+"",p)}else{k=l}}})});return k};return e})();var DataCube_Component=(function(){function e(){}e.getDefaultSelectedDimensions=function b(l){var p=[];var l=JSON.parse(JSON.stringify(l));var n=0;var m=0;var h=0;var j=0;var o=0;var q={};var k={};_.each(l,function(r,i){p=[];m=0;j=_.keys(r.__cv_elements).length;h=1+Math.floor(_.keys(r.__cv_elements).length*0.3);h=10<h?10:1>h?1:h;do{o=Math.floor((Math.random()*j));if(-1===$.inArray(o,p)){if((p.length+1)<=h){p.push(o)}if(h==p.length){break}}m++}while((2*h)>m);k={};n=0;_.each(r.__cv_elements,function(s,t){if(-1<$.inArray(n,p)){k[n]=s}n++});r.__cv_elements=k;q[i]=r});return q};e.getMeasures=function d(h){var i=[];_.each(h,function(j){i.push(j)});return i};e.findDimensionElement=function c(j,i){var h=null;_.each(j,function(k){if(k.__cv_uri==i){h=k}});return h};e.loadAllAttributes=function g(j,l,h,k,i,m){$.ajax({url:j+"getcomponents",data:{serviceUrl:l,modelIri:h,dsdUrl:k,dsUrl:i,componentType:"attribute"}}).error(function(p,n,o){throw new Error("Attribute loadAll: "+p.responseText)}).success(function(n){if(false===_.isUndefined(n)&&false===_.isUndefined(n.content)){m(n.content)}})};e.loadAllDimensions=function a(j,l,h,k,i,m){$.ajax({url:j+"getcomponents",data:{serviceUrl:l,modelIri:h,dsdUrl:k,dsUrl:i,componentType:"dimension"}}).error(function(p,n,o){throw new Error("loadAllDimensions: "+p.responseText)}).success(function(n){if(false===_.isUndefined(n)&&false===_.isUndefined(n.content)){m(n.content)}})};e.loadAllMeasures=function f(j,l,h,k,i,m){$.ajax({url:j+"getcomponents",data:{serviceUrl:l,modelIri:h,dsdUrl:k,dsUrl:i,componentType:"measure"}}).error(function(p,n,o){throw new Error("loadAllMeasures: "+p.responseText)}).done(function(n){if(false===_.isUndefined(n)&&false===_.isUndefined(n.content)){m(n.content)}})};return e})();var DataCube_DataCubeMerger=(function(){function d(){}d.latestHash="";d.adaptDimensionElements=function k(o,n,m){var l=0;n=$.parseJSON(JSON.stringify(n));_.each(n,function(p){p["http://www.w3.org/1999/02/22-rdf-syntax-ns#type"]=o+"dimension"+m;p["http://purl.org/dc/terms/source"]=p.__cv_uri;if(false===_.isUndefined(p["http://www.w3.org/2002/07/owl#sameAs"])){p["http://www.w3.org/2002/07/owl#sameAs"]=[p["http://www.w3.org/2002/07/owl#sameAs"],p.__cv_uri]}else{p["http://www.w3.org/2002/07/owl#sameAs"]=p.__cv_uri}p.__cv_uri=o+"dimension"+m+"DimensionElement"+l;p.__cv_hashedUri=CryptoJS.MD5(p.__cv_uri)+"";++l});return n};d.buildDataSets=function i(n,m,l){return{0:{__cv_niceLabel:"Artifical Dataset of '"+m.__cv_niceLabel+"' and '"+l.__cv_niceLabel+"'","http://www.w3.org/2000/01/rdf-schema#label":"Artifical Dataset of '"+m.__cv_niceLabel+"' and '"+l.__cv_niceLabel+"'",__cv_description:"Its an artifical data set and it consists of '"+m.__cv_niceLabel+"' and '"+l.__cv_niceLabel+"'","http://www.w3.org/2000/01/rdf-schema#comment":"Its an artifical data set and it consists of '"+m.__cv_niceLabel+"' and '"+l.__cv_niceLabel+"'",__cv_uri:n+"dataset",__cv_hashedUri:CryptoJS.MD5(n+"dataset")+"","http://purl.org/dc/terms/source":[m.__cv_uri,l.__cv_uri],"http://purl.org/dc/terms/created":(new Date()).toString(),"http://purl.org/linked-data/cube#structure":n+"dataStructureDefinition","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"http://purl.org/linked-data/cube#DataSet",__cv_sourceDataset:[m,l]}}};d.buildDataStructureDefinitions=function h(o,n){var m={0:{__cv_niceLabel:"Artifical Data Structure Definition","http://www.w3.org/2000/01/rdf-schema#label":"Artifical Data Structure Definition",__cv_description:"This is an artifical data structure definition created during a data cube merge.","http://www.w3.org/2000/01/rdf-schema#comment":"This is an artifical data structure definition created during a data cube merge.",__cv_uri:o+"dataStructureDefinition",__cv_hashedUri:CryptoJS.MD5(o+"dataStructureDefinition")+"","http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"http://purl.org/linked-data/cube#DataStructureDefinition","http://purl.org/linked-data/cube#component":{0:o+"measure"},"http://purl.org/dc/terms/created":(new Date()).toString()}};var l=1;_.each(n,function(p){m[0]["http://purl.org/linked-data/cube#component"][l]=p.__cv_uri;++l});return m};d.buildDimensionsAndTheirComponentSpecifications=function e(q,p,l){var m={};var n=0;var o={};_.each(p,function(r){m={__cv_niceLabel:"Artifical Component Specification of '"+r[0].__cv_niceLabel+"' and '"+r[1].__cv_niceLabel+"'","http://www.w3.org/2000/01/rdf-schema#label":"Artifical Component Specification of '"+r[0].__cv_niceLabel+"' and '"+r[1].__cv_niceLabel+"'",__cv_description:"Its an artifical Component Specification and it consists of '"+r[0].__cv_niceLabel+"' and '"+r[1].__cv_niceLabel+"'","http://www.w3.org/2000/01/rdf-schema#comment":"Its an artifical Component Specification and it consists of '"+r[0].__cv_niceLabel+"' and '"+r[1].__cv_niceLabel+"'",__cv_uri:q+"componentSpecificationDimension"+n,__cv_hashedUri:CryptoJS.MD5(q+"componentSpecificationDimension"+n)+"","http://purl.org/dc/terms/source":[r[0].__cv_uri,r[1].__cv_uri],__cv_elements:{},__cv_oldCubeDimension:[r[0]["http://purl.org/linked-data/cube#dimension"],r[1]["http://purl.org/linked-data/cube#dimension"]],"http://purl.org/linked-data/cube#dimension":q+"dimension"+n,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"http://purl.org/linked-data/cube#ComponentSpecification","http://purl.org/dc/terms/created":(new Date()).toString(),__cv_sourceComponentSpecification:[r[0],r[1]]};m.__cv_elements=d.mergeDimensionElements(r[0].__cv_elements,r[1].__cv_elements,l);m.__cv_elements=d.adaptDimensionElements(q,m.__cv_elements,n);o[m.__cv_uri]=m;++n});return o};d.buildMeasure=function j(n,m,l){return{0:{__cv_niceLabel:"Artifical Measure of '"+m.__cv_niceLabel+"' and '"+l.__cv_niceLabel+"'","http://www.w3.org/2000/01/rdf-schema#label":"Artifical Measure of '"+m.__cv_niceLabel+"' and '"+l.__cv_niceLabel+"'",__cv_description:"Its an artifical measure and it consists of '"+m.__cv_niceLabel+"' and '"+l.__cv_niceLabel+"'","http://www.w3.org/2000/01/rdf-schema#comment":"Its an artifical measure and it consists of '"+m.__cv_niceLabel+"' and '"+l.__cv_niceLabel+"'",__cv_uri:n+"componentSpecificationMeasure",__cv_hashedUri:CryptoJS.MD5(n+"componentSpecificationMeasure")+"",__cv_oldCubeMeasure:[m["http://purl.org/linked-data/cube#measure"],l["http://purl.org/linked-data/cube#measure"]],"http://purl.org/linked-data/cube#measure":n+"measure","http://purl.org/dc/terms/source":[m.__cv_uri,l.__cv_uri],"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"http://purl.org/linked-data/cube#ComponentSpecification","http://purl.org/dc/terms/created":(new Date()).toString(),__cv_sourceComponentSpecification:[m,l]}}};d.buildObservations=function f(x,r,p,s,q,n,m,A,z,y){var o={};var w=null;var B=0;var t={};var u={};var v=[];var l=null;s=$.parseJSON(JSON.stringify(s));q=$.parseJSON(JSON.stringify(q));_.each(s,function(C){u[C.__cv_uri]=C});_.each(q,function(C){u[C.__cv_uri]=C});_.each(u,function(C){C.__cv_sourceObservation=$.parseJSON(JSON.stringify(C));if(C["http://purl.org/linked-data/cube#dataSet"]==r.__cv_uri){C.__cv_sourceDataset=r}else{C.__cv_sourceDataset=p}C["http://www.w3.org/2002/07/owl#sameAs"]=C.__cv_uri;C["http://purl.org/dc/terms/source"]=C.__cv_uri;C.__cv_uri=x+"observation"+B;C.__cv_hashedUri=CryptoJS.MD5(C.__cv_uri)+"";C["http://purl.org/linked-data/cube#dataSet"]=x+"dataset";C["http://purl.org/dc/terms/created"]=(new Date()).toString();l=null;_.each(n.__cv_oldCubeMeasure,function(D){if(false===_.isUndefined(C[D])){l=D}});if(false===_.isNull(l)){C[x+"measure"]=C[l];delete C[l];o[C.__cv_uri]=C;++B}else{}});u={};_.each(m,function(C){_.each(o,function(D){w=null;_.each(C.__cv_elements,function(E){if(true===_.isArray(E["http://www.w3.org/2002/07/owl#sameAs"])){_.each(E["http://www.w3.org/2002/07/owl#sameAs"],function(F){_.each(C.__cv_oldCubeDimension,function(G){if(F==D[G]){w=E.__cv_uri}})})}else{_.each(C.__cv_oldCubeDimension,function(F){if(E["http://www.w3.org/2002/07/owl#sameAs"]==D[F]){w=E.__cv_uri}})}});if(false===_.isNull(w)){D[x+"dimension"+A]=w;u[D.__cv_uri]=D}else{v.push(D.__cv_uri)}});++A});o={};_.each(u,function(C){if(-1===$.inArray(C.__cv_uri,v)){_.each(z,function(D){delete C[D["http://purl.org/linked-data/cube#dimension"]]});_.each(y,function(D){delete C[D["http://purl.org/linked-data/cube#dimension"]]});o[C.__cv_uri]=C}});return o};d.create=function g(y,q,o,n,p,w,v,m,x,u,t,r){var l={};var s="";l=d.getDefaultDataCubeObject();s=d.generateDataCubeUri(y,q);l.dataSets=d.buildDataSets(s,o,n);l.selectedDS=l.dataSets[0];l.components.dimensions=d.buildDimensionsAndTheirComponentSpecifications(s,p,r);l.selectedComponents.dimensions=l.components.dimensions;l.numberOfMultipleDimensions=_.size(CubeViz_Visualization_Controller.getMultipleDimensions(l.components.dimensions));l.numberOfOneElementDimensions=_.size(CubeViz_Visualization_Controller.getOneElementDimensions(l.components.dimensions));l.components.measures=d.buildMeasure(s,w,v);l.selectedComponents.measure=l.components.measures[0];l.dataStructureDefinitions=d.buildDataStructureDefinitions(s,l.components.dimensions);l.selectedDSD=l.dataStructureDefinitions[0];l.retrievedObservations=d.buildObservations(s,o,n,m,x,l.selectedComponents.measure,l.selectedComponents.dimensions,0,u,t);l.originalObservations={};_.each(m,function(z){l.originalObservations[z.__cv_uri]=z});_.each(x,function(z){l.originalObservations[z.__cv_uri]=z});return l};d.generateDataCubeUri=function c(l,m){d.latestHash=CryptoJS.MD5(m)+"";return l+"export/datacube/"+d.latestHash+"#"};d.getDefaultDataCubeObject=function a(){return{components:{attributes:null,dimensions:{},measures:{}},dataSets:{},dataStructureDefinitions:{},numberOfMultipleDimensions:0,numberOfOneElementDimensions:0,originalObservations:{},retrievedObservations:{},selectedComponents:{},selectedDS:{},selectedDSD:{},selectedSlice:{},slices:{},settings:{synchronizeWithStore:false}}};d.mergeDimensionElements=function b(p,o,l){var m={};var n=[];if("all"===l){_.each(p,function(q){m[q.__cv_uri]=q;n.push(q.__cv_uri);if(false===_.isUndefined(q["http://www.w3.org/2002/07/owl#sameAs"])){n.push(q["http://www.w3.org/2002/07/owl#sameAs"])}});_.each(o,function(q){if(-1==$.inArray(q.__cv_uri,n)){if(false===_.isUndefined(q["http://www.w3.org/2002/07/owl#sameAs"])&&-1<$.inArray(q["http://www.w3.org/2002/07/owl#sameAs"],n)){return}m[q.__cv_uri]=q;n.push(q.__cv_uri)}})}else{if("equal"===l||"unequal"===l){_.each(p,function(q){m[q.__cv_uri]=q;n.push(q.__cv_uri);if(false===_.isUndefined(q["http://www.w3.org/2002/07/owl#sameAs"])){n.push(q["http://www.w3.org/2002/07/owl#sameAs"])}});_.each(o,function(q){if(false===_.isUndefined(m[q.__cv_uri])){m[q.__cv_uri].__cv_double=q}else{if(false===_.isUndefined(q["http://www.w3.org/2002/07/owl#sameAs"])&&false===_.isUndefined(m[q["http://www.w3.org/2002/07/owl#sameAs"]])){m[q["http://www.w3.org/2002/07/owl#sameAs"]].__cv_double=q}}});if("equal"===l){_.each(m,function(r,q){if(true===_.isUndefined(r.__cv_double)){delete m[q]}})}else{_.each(m,function(r,q){if(false===_.isUndefined(r.__cv_double)){delete m[q]}})}}else{return}}return m};return d})();var DataCube_DataSet=(function(){function a(){}a.loadAll=function b(d,f,c,e,g){$.ajax({url:d+"getdatasets/",data:{serviceUrl:f,modelIri:c,dsdUrl:e}}).error(function(j,h,i){throw new Error("loadAll error: "+j.responseText)}).success(function(h){if(false===_.isUndefined(h)&&false===_.isUndefined(h.content)){g(h.content)}})};return a})();var DataCube_DataStructureDefinition=(function(){function b(){}b.loadAll=function c(e,f,d,g){$.ajax({url:e+"getdatastructuredefinitions/",data:{serviceUrl:f,modelIri:d}}).error(function(j,h,i){throw new Error("loadAll error: "+j.responseText)}).done(function(h){b.prepareLoadedDataStructureDefinitions(h,g)})};b.prepareLoadedDataStructureDefinitions=function a(d,e){d=JSON.parse(d);d.sort(function(g,f){return g.label.toUpperCase().localeCompare(f.label.toUpperCase())});e(d)};return b})();var DataCube_Observation=(function(){function f(){this._axes={}}f.prototype.addAxisEntryPointsTo=function(m,n,k){var l=this;_.each(k,function(p,o){k[o]={value:p,ref:l._axes[o][p]}});this._axes[m][n].push(k)};f.prototype.getAxesElements=function(k){if(false===_.isUndefined(this._axes[k])){return this._axes[k]}else{return{}}};f.getNumberOfActiveObservations=function b(l){var k=0;_.each(l,function(m){if(true===f.isActive(m)){++k}});return k};f.getUsedDimensionElementUris=function d(m,k){var l=[];_.each(m,function(n){if(-1===$.inArray(n[k],l)){l.push(n[k])}});return l};f.getValues=function g(p,m,n){if(typeof n==="undefined"){n=false}var k=false;var o=null;var l=[];_.each(p,function(q){if(true===n&&false===f.isActive(q)){return}o=f.parseValue(q,m);if(true===_.isNull(o)){k=true;return}else{l.push(o)}});return[l,k]};f.prototype.initialize=function(r,k,o){var q={};var n="";var m={};var l=this;var p=0;this._axes={};_.each(r,function(s){if(false===f.isActive(s)){return}p=f.parseValue(s,o);if(true===_.isNull(p)){return}_.each(k,function(t){n=t["http://purl.org/linked-data/cube#dimension"];m=s[n];if(true===_.isUndefined(l._axes[n])){l._axes[n]={}}if(true===_.isUndefined(l._axes[n][m])){q={__cv_uri:m,__cv_niceLabel:m};_.each(t.__cv_elements,function(u){if(u.__cv_uri==m){q=u}});l._axes[n][m]={observations:{},self:q}}l._axes[n][m].observations[s.__cv_uri]=s})});return this};f.isActive=function j(k){if(false===_.isUndefined(k.__cv_active)&&false===k.__cv_active){return false}return true};f.loadAll=function a(l,n,k,m,o,p){$.ajax({url:l+"getobservations/",data:{serviceUrl:n,modelIri:k,cv_dataHash:m,datasetUri:o}}).error(function(s,q,r){throw new Error("Observation loadAll error: "+s.responseText)}).done(function(q){p(q.content)})};f.loadNumberOfObservations=function i(l,n,k,m,o){$.ajax({url:l+"getnumberofobservations/",data:{serviceUrl:n,modelIri:k,dsUri:m}}).error(function(r,p,q){throw new Error("Observation loadNumberOfObservations error: "+r.responseText)}).done(function(p){o(p.content)})};f.markActiveObservations=function c(o,n,l,k){o=$.parseJSON(JSON.stringify(o));_.each(o,function(p,q){p.__cv_active=false;o[q]=p});var m=null;_.each(o,function(p,q){_.each(n,function(r){m=r["http://purl.org/linked-data/cube#dimension"];if(false===_.isNull(DataCube_Component.findDimensionElement(r.__cv_elements,p[m]))){p.__cv_active=true}})});return o};f.parseValue=function h(l,n){var k=null;var o=null;if(false===_.isUndefined(l.__cv_temporaryNewValue)){o=l.__cv_temporaryNewValue}else{o=l[n]}try{if(true===_.str.include(o," ")){k=parseFloat(o.replace(/ /gi,""))}else{k=parseFloat(o)}if(false===_.isNaN(k)&&_.isFinite(k)&&(0<k||0>k||0===k)){return k}}catch(m){}return null};f.setOriginalValue=function e(k,l,m){if(false===_.isUndefined(k.__cv_temporaryNewValue)){k.__cv_temporaryNewValue=null;delete k.__cv_temporaryNewValue}k[l]=m};f.prototype.sortAxis=function(m,o){var n=this._axes[m];var o=true===_.isUndefined(o)?"ascending":o;var p=[];var k={};var l=this;_.each(n,function(r,q){p.push({key:q,label:r.self.__cv_niceLabel})});switch(o){case"descending":p.sort(function(r,q){r=String(r.label).toLowerCase();q=String(q.label).toLowerCase();return((r>q)?-1:((r<q)?1:0))});break;default:p.sort(function(r,q){r=String(r.label).toLowerCase();q=String(q.label).toLowerCase();return((r<q)?-1:((r>q)?1:0))});break}_.each(p,function(q){k[q.key]=l._axes[m][q.key]});this._axes[m]=k;return this};return f})();var DataCube_Slice=(function(){function a(){}a.loadAll=function b(e,g,c,f,d,h){$.ajax({url:e+"getslices",data:{serviceUrl:g,modelIri:c,dsdUrl:f,dsUrl:d}}).error(function(k,i,j){throw new Error("DataCube_Slice > loadAll: "+k.responseText)}).success(function(i){if(false===_.isUndefined(i)&&false===_.isUndefined(i.content)){h(i.content)}})};return a})();var View_CompareAction_ModelSelection=(function(a){__extends(b,a);function b(c,d){a.call(this,"View_CompareAction_ModelSelection",c,d);this.bindGlobalEvents([{name:"onStart_application",handler:this.onStart_application}])}b.prototype.destroy=function(){a.prototype.destroy.call(this);return this};b.prototype.handleModelSelectorChanges=function(d){var c=_.str.trim($("#cubeviz-compare-modelSelector"+d+" option:selected").text());var e=$("#cubeviz-compare-modelSelector"+d).val();if(""!=e){this.app._.compareAction.models[d]={__cv_compareNr:d,__cv_uri:e,__cv_niceLabel:c};this.triggerGlobalEvent("onSelect_model"+d);if(""!=this.app._.compareAction.models[1]&&""!=this.app._.compareAction.models[2]){this.triggerGlobalEvent("onSelect_model1AndModel2")}}else{this.app._.compareAction.models[d]=null;this.triggerGlobalEvent("onSelect_noModel"+d)}};b.prototype.initialize=function(){this.collection.reset("__cv_uri");this.render()};b.prototype.onChange_modelSelector1=function(){this.handleModelSelectorChanges("1")};b.prototype.onChange_modelSelector2=function(){this.handleModelSelectorChanges("2")};b.prototype.onStart_application=function(){this.initialize()};b.prototype.render=function(){this.bindUserInterfaceEvents({"change #cubeviz-compare-modelSelector1":this.onChange_modelSelector1,"change #cubeviz-compare-modelSelector2":this.onChange_modelSelector2});return this};return b})(CubeViz_View_Abstract);var View_CompareAction_DatasetSelection=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_CompareAction_DatasetSelection",c,d);this.bindGlobalEvents([{name:"onReceive_datasets",handler:this.onReceive_datasets},{name:"onReceive_noDatasets",handler:this.onReceive_noDatasets},{name:"onSelect_model1",handler:this.onSelect_model1},{name:"onSelect_model2",handler:this.onSelect_model2},{name:"onSelect_noModel1",handler:this.onSelect_noModel1},{name:"onSelect_noModel2",handler:this.onSelect_noModel2},{name:"onStart_application",handler:this.onStart_application}])}a.prototype.destroy=function(){b.prototype.destroy.call(this);return this};a.prototype.fillSelectBox=function(c,e){var d={};$(c).html('<option value="">- please select -</option>');_.each(e,function(f){d=$("<option/>");d.attr("value",f.__cv_uri).data("self",f).text(f.__cv_niceLabel);$(c).append(d)})};a.prototype.initialize=function(){this.collection.reset("__cv_uri");this.render()};a.prototype.handleDatasetSelectorChanges=function(c,d){var e=$("#cubeviz-compare-datasetSelector"+c).val();if(true===_.str.isBlank(e)){this.app._.compareAction.datasets[c]=null;this.triggerGlobalEvent("onSelected_noDataset"+c)}else{d.__cv_compareNr=c;this.app._.compareAction.datasets[c]=d;this.triggerGlobalEvent("onSelected_dataset"+c)}if(false===_.isNull(this.app._.compareAction.datasets[1])&&false===_.isNull(this.app._.compareAction.datasets[2])){this.triggerGlobalEvent("onSelected_dataset1AndDataset2")}};a.prototype.handleModelSelectorChanges=function(d){var c=this;$("#cubeviz-compare-datasetSelectionDiv"+d).show();$("#cubeviz-compare-datasetSelector"+d).html('<option value="">please wait ... </option>');DataCube_DataSet.loadAll(this.app._.backend.url,"",this.app._.compareAction.models[d].__cv_uri,"",function(e){c.onReceive_datasets(e,d)})};a.prototype.onReceive_datasets=function(c,e){var d=this;$("#cubeviz-compare-datasetSelectorWarningBox"+e).hide();if(0<_.size(c)){d.fillSelectBox("#cubeviz-compare-datasetSelector"+e,c)}else{$("#cubeviz-compare-datasetSelector"+e).html('<option value="">Choose another model ... </option>');d.triggerGlobalEvent("onReceive_noDatasets",{modelNr:e,modelUri:d.app._.compareAction.models[e].__cv_uri})}};a.prototype.onReceive_noDatasets=function(c,d){$("#cubeviz-compare-datasetSelectorWarningBox"+d.modelNr).show()};a.prototype.onSelect_dataset1=function(c){this.handleDatasetSelectorChanges("1",$(c.target).find("option:selected").data("self"))};a.prototype.onSelect_dataset2=function(c){this.handleDatasetSelectorChanges("2",$(c.target).find("option:selected").data("self"))};a.prototype.onSelect_model1=function(c,d){this.handleModelSelectorChanges("1")};a.prototype.onSelect_model2=function(c,d){this.handleModelSelectorChanges("2")};a.prototype.onSelect_noModel1=function(){$("#cubeviz-compare-datasetSelectionDiv1").hide()};a.prototype.onSelect_noModel2=function(){$("#cubeviz-compare-datasetSelectionDiv2").hide()};a.prototype.onStart_application=function(){this.initialize()};a.prototype.render=function(){this.bindUserInterfaceEvents({"change #cubeviz-compare-datasetSelector1":this.onSelect_dataset1,"change #cubeviz-compare-datasetSelector2":this.onSelect_dataset2});return this};return a})(CubeViz_View_Abstract);var View_CompareAction_GeneralDatasetInformation=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_CompareAction_GeneralDatasetInformation",c,d);this.bindGlobalEvents([{name:"onReceived_attributes1AndAttributes2",handler:this.onReceived_attributes1AndAttributes2},{name:"onReceived_dimensions1AndDimensions2",handler:this.onReceived_dimensions1AndDimensions2},{name:"onReceived_measures1AndMeasures2",handler:this.onReceived_measures1AndMeasures2},{name:"onReceived_numbersOfObservations1AndNumbersOfObservations2",handler:this.onReceived_numbersOfObservations1AndNumbersOfObservations2},{name:"onReceived_slices1AndSlices2",handler:this.onReceived_slices1AndSlices2},{name:"onSelected_dataset1",handler:this.onSelected_dataset1},{name:"onSelected_dataset2",handler:this.onSelected_dataset2},{name:"onStart_application",handler:this.onStart_application}])}a.prototype.destroy=function(){b.prototype.destroy.call(this);return this};a.prototype.displayAttributesInformation1=function(){var c=$("#cubeviz-compare-generalDatasetInformation1").find(".cubeviz-compare-informationPieceBox");$($(c.get(3)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(_.size(this.app._.compareAction.components.attributes[1]));$("#cubeviz-compare-generalDatasetInformation1").show()};a.prototype.displayAttributesInformation2=function(){var c=$("#cubeviz-compare-generalDatasetInformation2").find(".cubeviz-compare-informationPieceBox");$($(c.get(3)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(_.size(this.app._.compareAction.components.attributes[2]));$("#cubeviz-compare-generalDatasetInformation2").show()};a.prototype.displayDimensionsInformation1=function(){var c=$("#cubeviz-compare-generalDatasetInformation1").find(".cubeviz-compare-informationPieceBox");$($(c.get(0)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(_.size(this.app._.compareAction.components.dimensions[1]));$("#cubeviz-compare-generalDatasetInformation1").show()};a.prototype.displayDimensionsInformation2=function(){var c=$("#cubeviz-compare-generalDatasetInformation2").find(".cubeviz-compare-informationPieceBox");$($(c.get(0)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(_.size(this.app._.compareAction.components.dimensions[2]));$("#cubeviz-compare-generalDatasetInformation2").show()};a.prototype.displayDimensionElementsInformation1=function(){var e=$("#cubeviz-compare-generalDatasetInformation1").find(".cubeviz-compare-informationPieceBox");var c=0;var d=this;_.each(this.app._.compareAction.components.dimensions[1],function(f){c+=_.size(f.__cv_elements)});$($(e.get(1)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(c);$("#cubeviz-compare-generalDatasetInformation1").show()};a.prototype.displayDimensionElementsInformation2=function(){var e=$("#cubeviz-compare-generalDatasetInformation2").find(".cubeviz-compare-informationPieceBox");var c=0;var d=this;_.each(this.app._.compareAction.components.dimensions[2],function(f){_.each(f.__cv_elements,function(g){++c})});$($(e.get(1)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(c);$("#cubeviz-compare-generalDatasetInformation1").show()};a.prototype.displayMeasuresInformation1=function(){var c=$("#cubeviz-compare-generalDatasetInformation1").find(".cubeviz-compare-informationPieceBox");$($(c.get(2)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(_.size(this.app._.compareAction.components.measures[1]));$("#cubeviz-compare-generalDatasetInformation1").show()};a.prototype.displayMeasuresInformation2=function(){var c=$("#cubeviz-compare-generalDatasetInformation2").find(".cubeviz-compare-informationPieceBox");$($(c.get(2)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(_.size(this.app._.compareAction.components.measures[2]));$("#cubeviz-compare-generalDatasetInformation2").show()};a.prototype.displayNumberOfObservations1=function(){var c=$("#cubeviz-compare-generalDatasetInformation1").find(".cubeviz-compare-informationPieceBox");$($(c.get(5)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(this.app._.compareAction.numberOfObservations[1]);$("#cubeviz-compare-generalDatasetInformation1").show()};a.prototype.displayNumberOfObservations2=function(){var c=$("#cubeviz-compare-generalDatasetInformation2").find(".cubeviz-compare-informationPieceBox");$($(c.get(5)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(this.app._.compareAction.numberOfObservations[2]);$("#cubeviz-compare-generalDatasetInformation2").show()};a.prototype.displaySlicesInformation1=function(){var c=$("#cubeviz-compare-generalDatasetInformation1").find(".cubeviz-compare-informationPieceBox");$($(c.get(4)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(_.size(this.app._.compareAction.slices[1]));$("#cubeviz-compare-generalDatasetInformation1").show()};a.prototype.displaySlicesInformation2=function(){var c=$("#cubeviz-compare-generalDatasetInformation2").find(".cubeviz-compare-informationPieceBox");$($(c.get(4)).find(".cubeviz-compare-informationPieceBoxValue").first()).html(_.size(this.app._.compareAction.slices[2]));$("#cubeviz-compare-generalDatasetInformation2").show()};a.prototype.initialize=function(){this.render()};a.prototype.handleDatasetSelectorChanges=function(d){var c=this;this.app._.compareAction.components.dimensions[d]=null;this.app._.compareAction.components.measures[d]=null;this.app._.compareAction.components.attributes[d]=null;DataCube_Component.loadAllDimensions(this.app._.backend.url,"",this.app._.compareAction.models[d].__cv_uri,this.app._.compareAction.datasets[d]["http://purl.org/linked-data/cube#structure"],this.app._.compareAction.datasets[d].__cv_uri,function(e){c.app._.compareAction.components.dimensions[d]=e;c.triggerGlobalEvent("onReceived_dimensions"+d);if(false===_.isNull(c.app._.compareAction.components.dimensions[1])&&false===_.isNull(c.app._.compareAction.components.dimensions[2])){c.triggerGlobalEvent("onReceived_dimensions1AndDimensions2")}});DataCube_Component.loadAllMeasures(this.app._.backend.url,"",this.app._.compareAction.models[d].__cv_uri,this.app._.compareAction.datasets[d]["http://purl.org/linked-data/cube#structure"],this.app._.compareAction.datasets[d].__cv_uri,function(e){c.app._.compareAction.components.measures[d]=e;c.triggerGlobalEvent("onReceived_measures"+d);if(false===_.isNull(c.app._.compareAction.components.measures[1])&&false===_.isNull(c.app._.compareAction.components.measures[2])){c.triggerGlobalEvent("onReceived_measures1AndMeasures2")}});DataCube_Component.loadAllAttributes(this.app._.backend.url,"",this.app._.compareAction.models[d].__cv_uri,this.app._.compareAction.datasets[d]["http://purl.org/linked-data/cube#structure"],this.app._.compareAction.datasets[d].__cv_uri,function(e){c.app._.compareAction.components.attributes[d]=e;c.triggerGlobalEvent("onReceived_attributes"+d);if(false===_.isNull(c.app._.compareAction.components.measures[1])&&false===_.isNull(c.app._.compareAction.components.measures[2])){c.triggerGlobalEvent("onReceived_attributes1AndAttributes2")}});DataCube_Slice.loadAll(this.app._.backend.url,"",this.app._.compareAction.models[d].__cv_uri,this.app._.compareAction.datasets[d]["http://purl.org/linked-data/cube#structure"],this.app._.compareAction.datasets[d].__cv_uri,function(e){c.app._.compareAction.slices[d]=e;c.triggerGlobalEvent("onReceived_slices"+d);if(false===_.isNull(c.app._.compareAction.slices[1])&&false===_.isNull(c.app._.compareAction.slices[2])){c.triggerGlobalEvent("onReceived_slices1AndSlices2")}});DataCube_Observation.loadNumberOfObservations(this.app._.backend.url,"",this.app._.compareAction.models[d].__cv_uri,this.app._.compareAction.datasets[d].__cv_uri,function(e){c.app._.compareAction.numberOfObservations[d]=e;c.triggerGlobalEvent("onReceived_observationNumber"+d);if(-1<c.app._.compareAction.numberOfObservations[1]&&-1<c.app._.compareAction.numberOfObservations[2]){c.triggerGlobalEvent("onReceived_numbersOfObservations1AndNumbersOfObservations2")}});DataCube_Observation.loadAll(this.app._.backend.url,"",this.app._.compareAction.models[d].__cv_uri,"",this.app._.compareAction.datasets[d].__cv_uri,function(e){c.app._.compareAction.originalObservations[d]=e;c.app._.compareAction.retrievedObservations[d]=e;c.triggerGlobalEvent("onReceived_observations"+d);if(false==_.isNull(c.app._.compareAction.originalObservations[1])&&false==_.isNull(c.app._.compareAction.originalObservations[2])){c.triggerGlobalEvent("onReceived_observations1AndObservations2")}})};a.prototype.onSelected_dataset1=function(c){this.handleDatasetSelectorChanges("1")};a.prototype.onSelected_dataset2=function(c){this.handleDatasetSelectorChanges("2")};a.prototype.onReceived_attributes1AndAttributes2=function(){this.displayAttributesInformation1();this.displayAttributesInformation2()};a.prototype.onReceived_dimensions1AndDimensions2=function(){this.displayDimensionsInformation1();this.displayDimensionsInformation2();this.displayDimensionElementsInformation1();this.displayDimensionElementsInformation2()};a.prototype.onReceived_measures1AndMeasures2=function(){this.displayMeasuresInformation1();this.displayMeasuresInformation2()};a.prototype.onReceived_numbersOfObservations1AndNumbersOfObservations2=function(){this.displayNumberOfObservations1();this.displayNumberOfObservations2()};a.prototype.onReceived_slices1AndSlices2=function(){this.displaySlicesInformation1();this.displaySlicesInformation2()};a.prototype.onStart_application=function(){this.initialize()};a.prototype.render=function(){this.bindUserInterfaceEvents({});return this};return a})(CubeViz_View_Abstract);var View_CompareAction_DimensionOverview=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_CompareAction_DimensionOverview",c,d);this.bindGlobalEvents([{name:"onReceived_dimensions1AndDimensions2",handler:this.onReceived_dimensions1AndDimensions2},{name:"onStart_application",handler:this.onStart_application}])}a.prototype.destroy=function(){b.prototype.destroy.call(this);return this};a.prototype.displayEqualDimensions=function(){var j="";var g=null;var f=null;var d=0;var e=0;var h=2000;var c=this;if(0<_.size(this.app._.compareAction.equalDimensions)){$("#cubeviz-compare-equalDimensions1").show();$("#cubeviz-compare-equalDimensions2").show();$("#cubeviz-compare-equalDimensionsTableContainer1").html("");$("#cubeviz-compare-equalDimensionsTableContainer2").html("");_.each(this.app._.compareAction.equalDimensions,function(i){j=i[0].__cv_description;if(true===_.str.isBlank(j)){j="no description found"}g=$(CubeViz_View_Helper.tplReplace($("#cubeviz-compare-tpl-equalDimension").html(),{dimensionLabel:i[0].__cv_niceLabel,dimensionDescription:j}));if(false===_.isUndefined(i[0].__cv_equalElements)&&0<_.size(i[0].__cv_equalElements)){f=$($(g).find(".cubeviz-compare-dimensionTitleAndElements").first());f.append($('<td rowspan="3" style="vertical-align: middle;"><div style="-webkit-transform:rotate(-90deg);">Dimension Elements</div></td>'));_.each(i[0].__cv_equalElements,function(k){f.append($('<td rowspan="3" style="vertical-align: middle;"><div style="-webkit-transform:rotate(-90deg);">'+k.__cv_niceLabel+"</div></td>"))});$($(g).find(".cubeviz-compare-dimensionNumberOfUnequalDimensionElements").first()).html(_.size(i[0].__cv_elements)-_.size(i[0].__cv_equalElements));$($(g).find(".cubeviz-compare-dimensionNumberOfEqualDimensionElements").first()).html(_.size(i[0].__cv_equalElements))}$("#cubeviz-compare-equalDimensionsTableContainer1").append(g);j=i[1].__cv_description;if(true===_.str.isBlank(j)){j="no description found"}g=$(CubeViz_View_Helper.tplReplace($("#cubeviz-compare-tpl-equalDimension").html(),{dimensionLabel:i[1].__cv_niceLabel,dimensionDescription:j}));if(false===_.isUndefined(i[1].__cv_equalElements)&&0<_.size(i[1].__cv_equalElements)){f=$($(g).find(".cubeviz-compare-dimensionTitleAndElements").first());f.append($('<td rowspan="3" style="vertical-align: middle;"><div style="-webkit-transform:rotate(-90deg);">Dimension Elements</div></td>'));_.each(i[1].__cv_equalElements,function(k){f.append($('<td rowspan="3" style="vertical-align: middle;"><div style="-webkit-transform:rotate(-90deg);">'+k.__cv_niceLabel+"</div></td>"))});$($(g).find(".cubeviz-compare-dimensionNumberOfUnequalDimensionElements").first()).html(_.size(i[1].__cv_elements)-_.size(i[1].__cv_equalElements));$($(g).find(".cubeviz-compare-dimensionNumberOfEqualDimensionElements").first()).html(_.size(i[1].__cv_equalElements))}$("#cubeviz-compare-equalDimensionsTableContainer2").append(g);h+=1000});$("#cubeviz-compare-equalDimensionsTableContainer1").width(h);$("#cubeviz-compare-equalDimensionsTableContainer2").width(h)}};a.prototype.displayUnequalDimensions=function(){var e=null;var d="";var c=0;$("#cubeviz-compare-unequalDimensionsTableContainer1").html("");if(0<_.size(this.app._.compareAction.unequalDimensions[1])||0<_.size(this.app._.compareAction.unequalDimensions[2])){$("#cubeviz-compare-unequalDimensions1").show();$("#cubeviz-compare-unequalDimensions2").show()}_.each(this.app._.compareAction.unequalDimensions[1],function(f){d=f.__cv_description;if(true===_.str.isBlank(d)){d="no description found"}e=$(CubeViz_View_Helper.tplReplace($("#cubeviz-compare-tpl-unequalDimension").html(),{dimensionLabel:f.__cv_niceLabel,dimensionDescription:d}));$(e.find(".cubeviz-compare-numberOfDimensionElements").first()).html(_.size(f.__cv_elements));$("#cubeviz-compare-unequalDimensionsTableContainer1").append(e);c+=220});$(".cubeviz-compare-unequalDimensions").css("min-width",c);_.each(this.app._.compareAction.unequalDimensions[2],function(f){d=f.__cv_description;if(true===_.str.isBlank(d)){d="no description found"}e=$(CubeViz_View_Helper.tplReplace($("#cubeviz-compare-tpl-unequalDimension").html(),{dimensionLabel:f.__cv_niceLabel,dimensionDescription:d}));$(e.find(".cubeviz-compare-numberOfDimensionElements").first()).html(_.size(f.__cv_elements));$("#cubeviz-compare-unequalDimensionsTableContainer2").append(e)})};a.prototype.findEqualDimensions=function(){var g=null;var e=null;var d=this;var f={};var c=[];d.app._.compareAction.equalDimensions=[];d.app._.compareAction.unequalDimensions={1:[],2:[]};_.each(this.app._.compareAction.components.dimensions[1],function(h){f[h.__cv_uri]=h.__cv_uri;if(false===_.str.isBlank(h["http://www.w3.org/2002/07/owl#sameAs"])){f[h["http://www.w3.org/2002/07/owl#sameAs"]]=h.__cv_uri}});_.each(this.app._.compareAction.components.dimensions[2],function(h){if(false===_.isUndefined(f[h.__cv_uri])||false===_.isUndefined(f[h["http://www.w3.org/2002/07/owl#sameAs"]])){if(false===_.isUndefined(f[h.__cv_uri])){e=d.app._.compareAction.components.dimensions[1][f[h.__cv_uri]]}else{e=d.app._.compareAction.components.dimensions[1][f[h["http://www.w3.org/2002/07/owl#sameAs"]]]}g=d.findEqualDimensionElements(e,h);e.__cv_equalElements=g[1];h.__cv_equalElements=g[2];d.app._.compareAction.equalDimensions.push([e,h]);c.push(e.__cv_uri)}else{d.app._.compareAction.unequalDimensions[2].push(h)}});_.each(this.app._.compareAction.components.dimensions[1],function(h){if(-1===$.inArray(h.__cv_uri,c)){d.app._.compareAction.unequalDimensions[1].push(h)}});if(0<_.size(this.app._.compareAction.equalDimensions)){this.triggerGlobalEvent("onFound_equalDimensions")}};a.prototype.findEqualDimensionElements=function(e,d){var c={1:[],2:[]};var f={};if(0==_.size(e.__cv_elements)||0==_.size(d.__cv_elements)){return c}_.each(e.__cv_elements,function(g){f[g.__cv_uri]=g;if(false===_.str.isBlank(g["http://www.w3.org/2002/07/owl#sameAs"])){f[g["http://www.w3.org/2002/07/owl#sameAs"]]=g}});_.each(d.__cv_elements,function(g){if(false===_.isUndefined(f[g.__cv_uri])){c[1].push(f[g.__cv_uri]);c[2].push(g)}if(false===_.isUndefined(f[g["http://www.w3.org/2002/07/owl#sameAs"]])){c[1].push(f[g["http://www.w3.org/2002/07/owl#sameAs"]]);c[2].push(g)}});return c};a.prototype.onReceived_dimensions1AndDimensions2=function(c){this.findEqualDimensions();this.displayUnequalDimensions();this.displayEqualDimensions()};a.prototype.onStart_application=function(){this.initialize()};a.prototype.render=function(){this.bindUserInterfaceEvents({});return this};return a})(CubeViz_View_Abstract);var View_CompareAction_MeasureAndAttributeInformation=(function(a){__extends(b,a);function b(c,d){a.call(this,"View_CompareAction_MeasureAndAttributeInformation",c,d);this._measures1And2Recveived=false;this._observations1And2Received=false;this.bindGlobalEvents([{name:"onReceived_measures1AndMeasures2",handler:this.onReceived_measures1AndMeasures2},{name:"onReceived_observations1AndObservations2",handler:this.onReceived_observations1AndObservations2},{name:"onStart_application",handler:this.onStart_application}])}b.prototype.destroy=function(){a.prototype.destroy.call(this);return this};b.prototype.displayMeasuresAndAttributesInformation=function(e){var h=$("#cubeviz-compare-measuresAndAttributesInformation"+e);var f=false;var g=this.app._.compareAction.components.measures[e][Object.keys(this.app._.compareAction.components.measures[e])[0]];var c=null;var d=null;d=DataCube_Observation.getValues(this.app._.compareAction.retrievedObservations[e],g["http://purl.org/linked-data/cube#measure"]);c=d[0];f=d[1];if(true===f){$("#cubeviz-compare-mAAInvalidNumbersFound"+e).show()}$(h.find(".cubeviz-compare-mAARangeMin").first()).html(true===f?"~ "+String(jsStats.min(c)).substring(0,10):String(jsStats.min(c)).substring(0,10));$(h.find(".cubeviz-compare-mAARangeMax").first()).html(true===f?"~ "+String(jsStats.max(c)).substring(0,10):String(jsStats.max(c)).substring(0,10));$(h.find(".cubeviz-compare-mAAMedian").first()).html(true===f?"~ "+String(jsStats.median(c)).substring(0,10):String(jsStats.median(c)).substring(0,10));$(h.find(".cubeviz-compare-mAAMean").first()).html(true===f?"~ "+String(jsStats.mean(c)).substring(0,10):String(jsStats.mean(c)).substring(0,10));$(h.find(".cubeviz-compare-mAAVariance").first()).html(true===f?"~ "+String(jsStats.variance(c)).substring(0,10):String(jsStats.variance(c)).substring(0,10));$(h.find(".cubeviz-compare-mAAStandardDeviation").first()).html(true===f?"~ "+String(jsStats.standardDeviation(c)).substring(0,10):String(jsStats.standardDeviation(c)).substring(0,10));$("#cubeviz-compare-measuresAndAttributesInformation"+e).show()};b.prototype.initialize=function(){this.collection.reset("__cv_uri");this.render()};b.prototype.onReceived_measures1AndMeasures2=function(){this._measures1And2Recveived=true;if(true===this._measures1And2Recveived&&true===this._observations1And2Received){this.displayMeasuresAndAttributesInformation(1);this.displayMeasuresAndAttributesInformation(2)}};b.prototype.onReceived_observations1AndObservations2=function(){this._observations1And2Received=true;if(true===this._measures1And2Recveived&&true===this._observations1And2Received){this.displayMeasuresAndAttributesInformation(1);this.displayMeasuresAndAttributesInformation(2)}};b.prototype.onStart_application=function(){this.initialize()};b.prototype.render=function(){this.bindUserInterfaceEvents({});return this};return b})(CubeViz_View_Abstract);var View_CompareAction_VisualizationSetup=(function(a){__extends(b,a);function b(c,d){a.call(this,"View_CompareAction_VisualizationSetup",c,d);this._equalDimensionsFound=false;this._measuresReceived=false;this._observationsReceived=false;this.bindGlobalEvents([{name:"onCreated_mergedDataCube",handler:this.onCreated_mergedDataCube},{name:"onFound_equalDimensions",handler:this.onFound_equalDimensions},{name:"onReceived_measures1AndMeasures2",handler:this.onReceived_measures1AndMeasures2},{name:"onReceived_observations1AndObservations2",handler:this.onReceived_observations1AndObservations2},{name:"onStart_application",handler:this.onStart_application}])}b.prototype.adaptObservationValues=function(f,j,d,g){try{var e={};var k="";var c=new formulaParser();var h="";e=$.parseJSON(JSON.stringify(d));_.each(e,function(l,m){k=DataCube_Observation.parseValue(l,g);h=j.split("$value$").join(k);h=h.split("$pi$").join(Math.PI+"");DataCube_Observation.setOriginalValue(l,g,c.parse(h).evaluate());e[m]=l});return e}catch(i){}return false};b.prototype.checkAndShowVisualizationSetup=function(){if(false===this._equalDimensionsFound||false===this._measuresReceived||false===this._observationsReceived){return}$("#cubeviz-compare-prepareAndGoToVisualizations").fadeIn();this.createMergedDataCube()};b.prototype.createMergedDataCube=function(){this.app._.compareAction.mergedDataCube=DataCube_DataCubeMerger.create(this.app._.backend.url,JSON.stringify(this.app._.compareAction),this.app._.compareAction.datasets[1],this.app._.compareAction.datasets[2],this.app._.compareAction.equalDimensions,DataCube_Component.getMeasures(this.app._.compareAction.components.measures[1])[0],DataCube_Component.getMeasures(this.app._.compareAction.components.measures[2])[0],this.app._.compareAction.retrievedObservations[1],this.app._.compareAction.retrievedObservations[2],this.app._.compareAction.components.dimensions[1],this.app._.compareAction.components.dimensions[1],$("input[name=cubeviz-compare-dimensionElementChoice]:checked").val());var c=this;CubeViz_ConfigurationLink.saveData(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,DataCube_DataCubeMerger.latestHash,this.app._.compareAction.mergedDataCube,function(){c.triggerGlobalEvent("onCreated_mergedDataCube",{dataHash:DataCube_DataCubeMerger.latestHash,mergedDataCube:c.app._.compareAction.mergedDataCube})},true)};b.prototype.destroy=function(){a.prototype.destroy.call(this);return this};b.prototype.displayAvailableVisualizations=function(h,e){var g=null;var f=this;var d={visualization:{className:""},visualizationSettings:{}};var c=null;$("#cubeviz-compare-availableVisualizations").html("");_.each(h,function(j){d.visualization.className=j.className;var i=CryptoJS.MD5(JSON.stringify(d))+"";CubeViz_ConfigurationLink.saveUI(f.app._.backend.url,f.app._.backend.serviceUrl,f.app._.backend.modelUrl,i,d,function(){g=f.app._.backend.url+"?";c=$('<div class="span2"><a><img class="cubeviz-compare-specificVisz" src="'+f.app._.backend.imagesPath+j.icon+'"/></a></div>');if(false===_.isNull(f.app._.backend.serviceUrl)){g+="serviceUrl="+encodeURIComponent(f.app._.backend.serviceUrl)+"&"}if(true===_.str.isBlank(f.app._.backend.modelUrl)){g+="m="+encodeURIComponent(f.app._.compareAction.models[1].__cv_uri)}else{g+="m="+encodeURIComponent(f.app._.backend.modelUrl)}g+="&cv_dataHash="+DataCube_DataCubeMerger.latestHash+"&cv_uiHash="+i;$(c.find("a").first()).attr("href",g).attr("target","_blank");$("#cubeviz-compare-availableVisualizations").append(c)})})};b.prototype.initialize=function(){this.render()};b.prototype.onChange_dimensionElementChoice=function(c){this.createMergedDataCube()};b.prototype.onClick_useBtn1=function(){var d=DataCube_Component.getMeasures(this.app._.compareAction.components.measures[1])[0]["http://purl.org/linked-data/cube#measure"];var c=this;this.app._.compareAction.retrievedObservations[1]=this.adaptObservationValues(1,$("#cubeviz-compare-confViz-datasetFormula1").val(),this.app._.compareAction.originalObservations[1],d);if(false===this.app._.compareAction.retrievedObservations[1]){return}this.createMergedDataCube()};b.prototype.onClick_useBtn2=function(){var d=DataCube_Component.getMeasures(this.app._.compareAction.components.measures[2])[0]["http://purl.org/linked-data/cube#measure"];var c=this;this.app._.compareAction.retrievedObservations[2]=this.adaptObservationValues(2,$("#cubeviz-compare-confViz-datasetFormula2").val(),this.app._.compareAction.originalObservations[2],d);if(false===this.app._.compareAction.retrievedObservations[2]){return}this.createMergedDataCube()};b.prototype.onCreated_mergedDataCube=function(c,d){this.displayAvailableVisualizations(this.app._.backend.chartConfig[_.size(this.app._.compareAction.equalDimensions)].charts,d.mergedDataCube)};b.prototype.onFound_equalDimensions=function(){this._equalDimensionsFound=true;$("#cubeviz-compare-confViz-datasetLabel1").html(_.str.prune(this.app._.compareAction.datasets[1].__cv_niceLabel,55));$("#cubeviz-compare-confViz-datasetLabel2").html(_.str.prune(this.app._.compareAction.datasets[2].__cv_niceLabel,55));this.checkAndShowVisualizationSetup()};b.prototype.onReceived_measures1AndMeasures2=function(){this._measuresReceived=true;this.checkAndShowVisualizationSetup()};b.prototype.onReceived_observations1AndObservations2=function(){this._observationsReceived=true;this.checkAndShowVisualizationSetup()};b.prototype.onStart_application=function(){this.initialize()};b.prototype.render=function(){this.bindUserInterfaceEvents({"click #cubeviz-compare-confViz-useBtn1":this.onClick_useBtn1,"click #cubeviz-compare-confViz-useBtn2":this.onClick_useBtn2,"change .cubeviz-compare-dimensionElementChoice":this.onChange_dimensionElementChoice});return this};return b})(CubeViz_View_Abstract);var View_CompareAction_ClusterVisualization=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_CompareAction_ClusterVisualization",c,d);this.bindGlobalEvents([{name:"onCreated_mergedDataCube",handler:this.onCreated_mergedDataCube}])}a.prototype.generateLink=function(g){var c=null;var e=[];var f=this.app._.compareAction.mergedDataCube.selectedComponents.measure["http://purl.org/linked-data/cube#measure"];var d=this;e=this.numberClustering(DataCube_Observation.getValues(this.app._.compareAction.mergedDataCube.retrievedObservations,f,true)[0],g);c=DataCube_ClusteringDataCube.create(e,this.app._.backend.url,g,this.app._.compareAction.mergedDataCube.retrievedObservations,this.app._.compareAction.mergedDataCube.selectedComponents.measure["http://purl.org/linked-data/cube#measure"],this.app._.compareAction.mergedDataCube.selectedDS);CubeViz_ConfigurationLink.saveData(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,DataCube_DataCubeMerger.latestHash,c,function(){var i=$('<li><a href="">Visualization for maximum '+g+" cluster</a></li>");var h=d.app._.backend.url+"?";if(false===_.isNull(d.app._.backend.serviceUrl)){h+="serviceUrl="+encodeURIComponent(d.app._.backend.serviceUrl)+"&"}if(true===_.str.isBlank(d.app._.backend.modelUrl)){h+="m="+encodeURIComponent(d.app._.compareAction.models[1].__cv_uri)}else{h+="m="+encodeURIComponent(d.app._.backend.modelUrl)}h+="&cv_dataHash="+DataCube_DataCubeMerger.latestHash;$(i.find("a")).attr("href",h).attr("target","_blank");$("#cubeviz-compare-clusterVisualizationLinks").append(i)},true)};a.prototype.initialize=function(){this.render()};a.prototype.numberClustering=function(g,c){var k=0;var q=true;var e=[];var o=[];var h=0;var d=0;var f=g.length;var r=Math.round(f/c)+1;var n=0;var p=0;var m=r;var s=0;g.sort(function(t,i){return t-i});for(var j=0;j<c;++j){o[j]=g.slice(p,m);p+=r;m+=r}if(p<f){var l=g.slice(p,f-p);_.each(l,function(i){o[c-1].push(i)})}for(j=0;j<c;++j){s=0;_.each(o[j],function(i){s+=i});e[j]=s/o[j].length}do{q=false;for(j=0;j<c;++j){_.each(o[j],function(t,i){n=-1;h=0;_.each(e,function(u,v){if(u>t){h=u-t}else{h=t-u}if(-1==n||h<=n){n=h;k=v}});if(k!=j){o[k].push(t);o[j].splice(i,1);q=true}})}}while(true===q);_.each(o,function(i){i.sort(function(u,t){return u-t})});return o};a.prototype.onClick_getLinkBtn=function(){this.generateLink($("#cubeviz-compare-clusterVisualizationClusterNumber").val())};a.prototype.onCreated_mergedDataCube=function(){this.initialize()};a.prototype.render=function(){this.bindUserInterfaceEvents({"click #cubeviz-compare-clusterVisualizationGetLinkBtn":this.onClick_getLinkBtn});return this};return a})(CubeViz_View_Abstract);var View_DataselectionModule_DataSet=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_CubeVizModule_DataSet",c,d);this.bindGlobalEvents([{name:"onStart_application",handler:this.onStart_application}])}a.prototype.destroy=function(){b.prototype.destroy.call(this);CubeViz_View_Helper.destroyDialog($("#cubeviz-dataSet-dialog"));return this};a.prototype.initialize=function(){this.collection.reset("__cv_uri");this.collection.addList(this.app._.data.dataSets);this.render()};a.prototype.onClick_closeAndUpdate=function(h){var f=$(h.target).data("dialogDiv");var e=new CubeViz_Collection("__cv_uri");var g=$("input[name=cubeviz-dataSelectionModule-dataSetRadio]:checked").val();var c=null;var d=this;CubeViz_View_Helper.showCloseAndUpdateSpinner(f);CubeViz_View_Helper.showLeftSidebarSpinner();c=e.addList(this.app._.data.dataSets).get(g);this.app._.data.selectedDS=c;CubeViz_View_Helper.hideCloseAndUpdateSpinner(f);CubeViz_View_Helper.closeDialog(f);$("#cubeviz-dataSet-label").html(_.str.prune(c.__cv_niceLabel,24,".."));this.app._.data.retrievedObservations={};_.each(this.app._.data.dataStructureDefinitions,function(j){if(j.__cv_uri==c["http://purl.org/linked-data/cube#structure"]){d.app._.data.selectedDSD=j}});var i={callback:function(){d.triggerGlobalEvent("onReRender_visualization")}};this.triggerGlobalEvent("onChange_selectedDS",i)};a.prototype.onClick_dialogOpener=function(e){var d=$($("#cubeviz-dataSelectionModule-dialog-dataSet").find(".cubeviz-dataSelectionModule-dialogElements").get(0)).children();var c=this;_.each(d,function(f){if(c.app._.data.selectedDS.__cv_uri==$($(f).children().first()).val()){$($(f).children().first()).attr("checked",true)}});CubeViz_View_Helper.openDialog($("#cubeviz-dataSelectionModule-dialog-dataSet"))};a.prototype.onClick_questionmark=function(d){$("#cubeviz-dataSelectionModule-dialogContainer").append(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-helpDialog").html(),{__cv_id:"dataSet",__cv_niceLabel:$("#cubeviz-dataSelectionModule-tra-dataSetHelpDialogTitle").html(),__cv_description:$("#cubeviz-dataSelectionModule-tra-dataSetHelpDialogDescription").html()}));var c=$("#cubeviz-dataSelectionModule-helpDialog-dataSet");CubeViz_View_Helper.attachDialogTo(c,{closeOnEscape:true,showCross:true,width:500});CubeViz_View_Helper.openDialog(c)};a.prototype.onStart_application=function(){this.initialize()};a.prototype.render=function(){this.triggerGlobalEvent("onBeforeRender_dataSet");$("#cubeviz-dataSet-label").html(_.str.prune(this.app._.data.selectedDS.__cv_niceLabel,24,"..")).attr("title",this.app._.data.selectedDS.__cv_niceLabel);if(1===_.size(this.app._.data.dataSets)){$("#cubeviz-dataSet-dialogOpener").hide()}else{$("#cubeviz-dataSelectionModule-dialogContainer").append(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialog").html(),{__cv_niceLabel:$("#cubeviz-dataSelectionModule-tra-dataSetHelpDialogTitle").html(),__cv_hashedUri:"dataSet",__cv_description:"",__cv_shortDescription:$("#cubeviz-dataSelectionModule-tra-dataSetHelpDialogDescription").html(),__cv_title:""}));var f=$("#cubeviz-dataSelectionModule-dialog-dataSet");CubeViz_View_Helper.attachDialogTo(f,{closeOnEscape:true,showCross:true,width:650});$(f.find(".cubeviz-dataSelectionModule-dialog-description").get(0)).hide();$(f.find(".cubeviz-dataSelectionModule-dialogSortButtons").get(0)).hide();$(f.find(".cubeviz-dataSelectionModule-selectAllButton").get(0)).hide();$(f.find(".cubeviz-dataSelectionModule-deselectButton").get(0)).hide();$("#cubeviz-dataSet-dialogOpener").data("dialogDiv",f);$($(f.find(".cubeviz-dataSelectionModule-cancelBtn")).get(0)).data("dialogDiv",f);$($(f.find(".cubeviz-dataSelectionModule-closeAndUpdateBtn")).get(0)).data("dialogDiv",f).on("click",$.proxy(this.onClick_closeAndUpdate,this));$($(f.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(0)).data("dialogDiv",f).data("type","alphabet");$($(f.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(1)).hide();$($(f.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(2)).hide();var e=new CubeViz_Collection("__cv_uri");var d=null;var c=$(f.find(".cubeviz-dataSelectionModule-dialogElements")[0]);e.addList(this.app._.data.dataSets).sortAscendingBy("__cv_niceLabel").each(function(g){d=$(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialogRadioElement").html(),{__cv_niceLabel:g.__cv_niceLabel,__cv_uri:g.__cv_uri,radioCSSClass:"cubeviz-dataSelectionModule-dataSetRadio",radioName:"cubeviz-dataSelectionModule-dataSetRadio",radioValue:g.__cv_uri}));c.append(d)});this.bindUserInterfaceEvents({"click #cubeviz-dataSet-dialogOpener":this.onClick_dialogOpener});$("#cubeviz-dataSet-dialogOpener").show()}this.triggerGlobalEvent("onAfterRender_dataSet");this.bindUserInterfaceEvents({"click #cubeviz-dataSet-questionmark":this.onClick_questionmark});return this};return a})(CubeViz_View_Abstract);var View_DataselectionModule_Slice=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_CubeVizModule_Slice",c,d);this.bindGlobalEvents([{name:"onChange_selectedDS",handler:this.onChange_selectedDS},{name:"onStart_application",handler:this.onStart_application}])}a.prototype.destroy=function(){b.prototype.destroy.call(this);return this};a.prototype.initialize=function(){this.collection.reset("__cv_uri");this.collection.addList(this.app._.data.slices);this.render()};a.prototype.onChange_selectedDS=function(){var c=this;DataCube_Slice.loadAll(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.data.selectedDSD.__cv_uri,this.app._.data.selectedDS.__cv_uri,function(d){c.app._.data.slices=d;if(0===_.keys(d).length){}else{c.app._.data.selectedSlice={}}})};a.prototype.onClick_closeAndUpdate=function(f){var e=$(f.target).data("dialogDiv");var h=new CubeViz_Collection("__cv_uri");var c=$("input[name=cubeviz-dataSelectionModule-sliceRadio]:checked").val();var d=this;CubeViz_View_Helper.showCloseAndUpdateSpinner(e);if("noSlice"==c){this.app._.data.selectedSlice={};$("#cubeviz-slice-label").html(_.str.prune($("#cubeviz-dataSelectionModule-tra-sliceNoSelection").html(),24,".."))}else{this.app._.data.selectedSlice=h.addList(this.app._.data.slices).get(c);$("#cubeviz-slice-label").html(_.str.prune(this.app._.data.selectedSlice.__cv_niceLabel,24,".."))}CubeViz_View_Helper.hideCloseAndUpdateSpinner(e);CubeViz_View_Helper.closeDialog(e);var g={callback:function(){d.triggerGlobalEvent("onReRender_visualization")}};this.triggerGlobalEvent("onChange_selectedSlice",g)};a.prototype.onClick_dialogOpener=function(c){CubeViz_View_Helper.openDialog($("#cubeviz-dataSelectionModule-dialog-slice"))};a.prototype.onClick_questionmark=function(d){$("#cubeviz-dataSelectionModule-dialogContainer").append(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-helpDialog").html(),{__cv_id:"slice",__cv_niceLabel:$("#cubeviz-dataSelectionModule-tra-sliceHelpDialogTitle").html(),__cv_description:$("#cubeviz-dataSelectionModule-tra-sliceHelpDialogDescription").html()}));var c=$("#cubeviz-dataSelectionModule-helpDialog-slice");CubeViz_View_Helper.attachDialogTo(c,{closeOnEscape:true,showCross:true,width:500});CubeViz_View_Helper.openDialog(c)};a.prototype.onStart_application=function(){this.initialize()};a.prototype.render=function(){this.triggerGlobalEvent("onBeforeRender_slice");var d="";var h="";var c=this;if(0===_.size(this.app._.data.slices)){$("#cubeviz-dataSelectionModule-sliceBlock").hide()}else{$("#cubeviz-dataSelectionModule-sliceBlock").show();if(0===_.keys(this.app._.data.selectedSlice).length){d=$("#cubeviz-dataSelectionModule-tra-sliceNoSelection").html()}else{d=this.app._.data.selectedComponents.attribute.__cv_niceLabel;h=this.app._.data.selectedComponents.attribute.__cv_description}$("#cubeviz-dataSelectionModule-dialogContainer").append(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialog").html(),{__cv_niceLabel:$("#cubeviz-dataSelectionModule-tra-sliceDialogTitle").html(),__cv_hashedUri:"slice",__cv_description:"",__cv_shortDescription:$("#cubeviz-dataSelectionModule-tra-sliceDialogDescription").html(),__cv_title:""}));var g=$("#cubeviz-dataSelectionModule-dialog-slice");CubeViz_View_Helper.attachDialogTo(g,{closeOnEscape:true,showCross:true,width:650});$(g.find(".cubeviz-dataSelectionModule-dialogSortButtons").get(0)).hide();$(g.find(".cubeviz-dataSelectionModule-selectAllButton").get(0)).hide();$(g.find(".cubeviz-dataSelectionModule-deselectButton").get(0)).hide();$("#cubeviz-slice-dialogOpener").data("dialogDiv",g);$($(g.find(".cubeviz-dataSelectionModule-cancelBtn")).get(0)).data("dialogDiv",g);$($(g.find(".cubeviz-dataSelectionModule-closeAndUpdateBtn")).get(0)).data("dialogDiv",g).on("click",$.proxy(this.onClick_closeAndUpdate,this));$($(g.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(0)).data("dialogDiv",g).data("type","alphabet");$($(g.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(1)).hide();$($(g.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(2)).hide();var f=null;var e=$(g.find(".cubeviz-dataSelectionModule-dialogElements")[0]);f=$(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialogRadioElement").html(),{__cv_niceLabel:$("#cubeviz-dataSelectionModule-tra-sliceDialogNoSliceSelectionElement").html(),__cv_uri:"__cv_noSlice",radioCSSClass:"cubeviz-dataSelectionModule-sliceRadio",radioName:"cubeviz-dataSelectionModule-sliceRadio",radioValue:"noSlice"}));if(0===_.size(this.app._.data.selectedSlice)){$(f.children().first()).attr("checked",true)}$(f.children().last()).css("font-weight","bold");e.append(f);this.collection.sortAscendingBy("__cv_niceLabel").each(function(i){f=$(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialogRadioElement").html(),{__cv_niceLabel:i.__cv_niceLabel,__cv_uri:i.__cv_uri,radioCSSClass:"cubeviz-dataSelectionModule-sliceRadio",radioName:"cubeviz-dataSelectionModule-sliceRadio",radioValue:i.__cv_uri}));if(i.__cv_uri==c.app._.data.selectedSlice.__cv_uri){$(f.children().first()).attr("checked",true)}e.append(f)});this.bindUserInterfaceEvents({"click #cubeviz-slice-dialogOpener":this.onClick_dialogOpener})}$("#cubeviz-slice-label").html(_.str.prune(d,24,"..")).attr("title",d);$("#cubeviz-slice-description").html(_.str.prune(h,55,"..")).attr("title",h);this.triggerGlobalEvent("onAfterRender_slice");this.bindUserInterfaceEvents({"click #cubeviz-slice-questionmark":this.onClick_questionmark});return this};return a})(CubeViz_View_Abstract);var View_DataselectionModule_Measure=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_CubeVizModule_Measure",c,d);this.bindGlobalEvents([{name:"onChange_selectedDS",handler:this.onChange_selectedDS},{name:"onStart_application",handler:this.onStart_application}])}a.prototype.destroy=function(){b.prototype.destroy.call(this);CubeViz_View_Helper.destroyDialog($("#cubeviz-measure-dialog"));return this};a.prototype.initialize=function(){this.collection.reset("__cv_uri");this.collection.addList(this.app._.data.components.measures);this.render()};a.prototype.onChange_selectedDS=function(d){var c=this;DataCube_Component.loadAllMeasures(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.data.selectedDSD.__cv_uri,this.app._.data.selectedDS.__cv_uri,function(e){c.app._.data.components.measures=e;if(0===_.keys(e).length){throw new Error("Error: There are no measures in the selected data set!")}else{c.app._.data.selectedComponents.measure=e[_.keys(e)[0]]}})};a.prototype.onClick_closeAndUpdate=function(g){var f=$(g.target).data("dialogDiv");var h=new CubeViz_Collection("__cv_uri");var e=$("input[name=cubeviz-dataSelectionModule-measureRadio]:checked").val();var c=null;var d=this;CubeViz_View_Helper.showCloseAndUpdateSpinner(f);CubeViz_View_Helper.showLeftSidebarSpinner();c=h.addList(this.app._.data.components.measures).get(e);this.app._.data.selectedComponents.measure=c;CubeViz_View_Helper.hideCloseAndUpdateSpinner(f);CubeViz_View_Helper.closeDialog(f);$("#cubeviz-measure-label").html(_.str.prune(c.__cv_niceLabel,24,".."));this.app._.backend.dataHash=CryptoJS.MD5(JSON.stringify(this.app._.data))+"";CubeViz_ConfigurationLink.saveData(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.backend.dataHash,this.app._.data,function(){DataCube_Observation.loadAll(d.app._.backend.url,d.app._.backend.serviceUrl,d.app._.backend.modelUrl,d.app._.backend.dataHash,"",function(i){d.app._.data.retrievedObservations=i;d.triggerGlobalEvent("onChange_selectedMeasure");d.triggerGlobalEvent("onReRender_visualization");CubeViz_View_Helper.hideLeftSidebarSpinner()})})};a.prototype.onClick_dialogOpener=function(e){var d=$($("#cubeviz-dataSelectionModule-dialog-measure").find(".cubeviz-dataSelectionModule-dialogElements").get(0)).children();var c=this;if(1==d.length){$($(d.first()).children().first()).attr("checked",true)}else{_.each(d,function(f){if(c.app._.data.selectedComponents.measure.__cv_uri==$($(f).children().first()).val()){$($(f).children().first()).attr("checked",true)}})}CubeViz_View_Helper.openDialog($("#cubeviz-dataSelectionModule-dialog-measure"))};a.prototype.onStart_application=function(){this.initialize()};a.prototype.render=function(){this.triggerGlobalEvent("onBeforeRender_measure");$("#cubeviz-measure-label").html(_.str.prune(this.app._.data.selectedComponents.measure.__cv_niceLabel,24,"..")).attr("title",this.app._.data.selectedComponents.measure.__cv_niceLabel);$("#cubeviz-measure-description").html(_.str.prune(this.app._.data.selectedComponents.measure.__cv_description,55,"..")).attr("title",this.app._.data.selectedComponents.measure.__cv_description);if(1==_.keys(this.app._.data.components.measures).length){$("#cubeviz-measure-dialogOpener").hide()}else{$("#cubeviz-dataSelectionModule-dialogContainer").append(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialog").html(),{__cv_niceLabel:$("#cubeviz-dataSelectionModule-tra-measureDialogTitle").html(),__cv_hashedUri:"measure",__cv_description:"",__cv_shortDescription:$("#cubeviz-dataSelectionModule-tra-measureDialogDescription").html(),__cv_title:""}));var e=$("#cubeviz-dataSelectionModule-dialog-measure");CubeViz_View_Helper.attachDialogTo(e,{closeOnEscape:true,showCross:true,width:650});$(e.find(".cubeviz-dataSelectionModule-dialog-description").get(0)).hide();$(e.find(".cubeviz-dataSelectionModule-dialogSortButtons").get(0)).hide();$(e.find(".cubeviz-dataSelectionModule-selectAllButton").get(0)).hide();$(e.find(".cubeviz-dataSelectionModule-deselectButton").get(0)).hide();$("#cubeviz-measure-dialogOpener").data("dialogDiv",e);$($(e.find(".cubeviz-dataSelectionModule-cancelBtn")).get(0)).data("dialogDiv",e);$($(e.find(".cubeviz-dataSelectionModule-closeAndUpdateBtn")).get(0)).data("dialogDiv",e).on("click",$.proxy(this.onClick_closeAndUpdate,this));$($(e.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(0)).data("dialogDiv",e).data("type","alphabet");$($(e.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(1)).hide();$($(e.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(2)).hide();var f=new CubeViz_Collection("__cv_uri");var d=null;var c=$(e.find(".cubeviz-dataSelectionModule-dialogElements")[0]);f.addList(this.app._.data.components.measures).sortAscendingBy("__cv_niceLabel").each(function(g){d=$(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialogRadioElement").html(),{__cv_niceLabel:g.__cv_niceLabel,__cv_uri:g.__cv_uri,radioCSSClass:"cubeviz-dataSelectionModule-measureRadio",radioName:"cubeviz-dataSelectionModule-measureRadio",radioValue:g.__cv_uri}));c.append(d)});this.bindUserInterfaceEvents({"click #cubeviz-measure-dialogOpener":this.onClick_dialogOpener})}this.triggerGlobalEvent("onAfterRender_measure");return this};return a})(CubeViz_View_Abstract);var View_DataselectionModule_Attribute=(function(a){__extends(b,a);function b(c,d){a.call(this,"View_CubeVizModule_Attribute",c,d);this.bindGlobalEvents([{name:"onChange_selectedDS",handler:this.onChange_selectedDS},{name:"onStart_application",handler:this.onStart_application}])}b.prototype.destroy=function(){a.prototype.destroy.call(this);$("#cubeviz-attribute-dialogOpener").off();CubeViz_View_Helper.destroyDialog($("#cubeviz-dataSelectionModule-dialog-attribute"));$("#cubeviz-dataSelectionModule-dialog-attribute").remove();return this};b.prototype.initialize=function(){this.collection.reset("__cv_uri");this.collection.addList(this.app._.data.components.attributes);this.render()};b.prototype.onChange_selectedDS=function(d){var c=this;DataCube_Component.loadAllAttributes(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.data.selectedDSD.__cv_uri,this.app._.data.selectedDS.__cv_uri,function(e){c.app._.data.components.attributes=e;if(0===_.keys(e).length){}else{c.app._.data.selectedComponents.attribute=e[_.keys(e)[0]]}c.destroy().initialize()})};b.prototype.onClick_closeAndUpdate=function(h){var g=$(h.target).data("dialogDiv");var f=new CubeViz_Collection("__cv_uri");var c=$("input[name=cubeviz-dataSelectionModule-attributeRadio]:checked").val();var d=null;var e=this;CubeViz_View_Helper.showCloseAndUpdateSpinner(g);CubeViz_View_Helper.showLeftSidebarSpinner();if("noAttribute"==c){this.app._.data.selectedComponents.attribute=null;$("#cubeviz-attribute-label").html(_.str.prune($("#cubeviz-dataSelectionModule-tra-attributeDialogNoAttributeSelectedLabel").html(),24,"..")).attr("title",$("#cubeviz-dataSelectionModule-tra-attributeDialogNoAttributeSelectedLabel").html());$("#cubeviz-attribute-description").html(_.str.prune($("#cubeviz-dataSelectionModule-tra-attributeDialogNoAttributeSelectedDescription").html(),55,"..")).attr("title",$("#cubeviz-dataSelectionModule-tra-attributeDialogNoAttributeSelectedDescription").html())}else{d=f.addList(this.app._.data.components.attributes).get(c);this.app._.data.selectedComponents.attribute=d;$("#cubeviz-attribute-label").html(_.str.prune(d.__cv_niceLabel,24,".."))}CubeViz_View_Helper.hideCloseAndUpdateSpinner(g);CubeViz_View_Helper.closeDialog(g);this.app._.backend.dataHash=CryptoJS.MD5(JSON.stringify(this.app._.data))+"";CubeViz_ConfigurationLink.saveData(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.backend.dataHash,this.app._.data,function(){DataCube_Observation.loadAll(e.app._.backend.url,e.app._.backend.serviceUrl,e.app._.backend.modelUrl,e.app._.backend.dataHash,"",function(i){e.app._.data.retrievedObservations=i;e.triggerGlobalEvent("onChange_selectedAttribute");e.triggerGlobalEvent("onReRender_visualization");CubeViz_View_Helper.hideLeftSidebarSpinner()})})};b.prototype.onClick_dialogOpener=function(e){var d=$($("#cubeviz-dataSelectionModule-dialog-attribute").find(".cubeviz-dataSelectionModule-dialogElements").get(0)).children();var c=this;if(false===_.isUndefined(this.app._.data.selectedComponents.attribute)&&false===_.isNull(this.app._.data.selectedComponents.attribute)){_.each(d,function(f){if(c.app._.data.selectedComponents.attribute.__cv_uri==$($(f).children().first()).val()){$($(f).children().first()).attr("checked",true)}})}CubeViz_View_Helper.openDialog($("#cubeviz-dataSelectionModule-dialog-attribute"))};b.prototype.onClick_questionmark=function(d){$("#cubeviz-dataSelectionModule-dialogContainer").append(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-helpDialog").html(),{__cv_id:"attributeAndMeasure",__cv_niceLabel:$("#cubeviz-dataSelectionModule-tra-attributeAndMeasureHelpDialogTitle").html(),__cv_description:$("#cubeviz-dataSelectionModule-tra-attributeAndMeasureHelpDialogDescription").html()}));var c=$("#cubeviz-dataSelectionModule-helpDialog-attributeAndMeasure");CubeViz_View_Helper.attachDialogTo(c,{closeOnEscape:true,showCross:true,width:500});CubeViz_View_Helper.openDialog(c)};b.prototype.onStart_application=function(){this.initialize()};b.prototype.render=function(){this.triggerGlobalEvent("onBeforeRender_attribute");var i=false;var c="";var g="";if(0===_.size(this.app._.data.components.attributes)){c="[no attribute found]";i=true;$("#cubeviz-dataSelectionModule-attributeBlock").hide()}else{if(0<_.size(this.app._.data.components.attributes)&&(true===_.isUndefined(this.app._.data.selectedComponents.attribute)||true===_.isNull(this.app._.data.selectedComponents.attribute))){c=$("#cubeviz-dataSelectionModule-tra-attributeDialogNoAttributeSelectedLabel").html();g=$("#cubeviz-dataSelectionModule-tra-attributeDialogNoAttributeSelectedDescription").html()}else{c=this.app._.data.selectedComponents.attribute.__cv_niceLabel;g=this.app._.data.selectedComponents.attribute.__cv_description}}$("#cubeviz-attribute-label").html(_.str.prune(c,24,"..")).attr("title",c);$("#cubeviz-attribute-description").html(_.str.prune(g,55,"..")).attr("title",g);if(false===i){if(0==_.size(this.app._.data.components.attributes)){$("#cubeviz-attribute-dialogOpener").hide()}else{$("#cubeviz-dataSelectionModule-dialogContainer").append(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialog").html(),{__cv_niceLabel:$("#cubeviz-dataSelectionModule-tra-attributeDialogTitle").html(),__cv_hashedUri:"attribute",__cv_description:"",__cv_shortDescription:$("#cubeviz-dataSelectionModule-tra-attributeDialogDescription").html(),__cv_title:""}));var f=$("#cubeviz-dataSelectionModule-dialog-attribute");CubeViz_View_Helper.attachDialogTo(f,{closeOnEscape:true,showCross:true,width:650});$(f.find(".cubeviz-dataSelectionModule-dialog-description").get(0)).hide();$(f.find(".cubeviz-dataSelectionModule-dialogSortButtons").get(0)).hide();$(f.find(".cubeviz-dataSelectionModule-selectAllButton").get(0)).hide();$(f.find(".cubeviz-dataSelectionModule-deselectButton").get(0)).hide();$("#cubeviz-attribute-dialogOpener").data("dialogDiv",f);$($(f.find(".cubeviz-dataSelectionModule-cancelBtn")).get(0)).data("dialogDiv",f);$($(f.find(".cubeviz-dataSelectionModule-closeAndUpdateBtn")).get(0)).data("dialogDiv",f).on("click",$.proxy(this.onClick_closeAndUpdate,this));$($(f.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(0)).data("dialogDiv",f).data("type","alphabet");$($(f.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(1)).hide();$($(f.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(2)).hide();var h=new CubeViz_Collection("__cv_uri");var e=null;var d=$(f.find(".cubeviz-dataSelectionModule-dialogElements")[0]);e=$(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialogRadioElement").html(),{__cv_niceLabel:$("#cubeviz-dataSelectionModule-tra-sliceDialogNoSliceSelectionElement").html(),__cv_uri:"__cv_noAttribute",radioCSSClass:"cubeviz-dataSelectionModule-attributeRadio",radioName:"cubeviz-dataSelectionModule-attributeRadio",radioValue:"noAttribute"}));$(e.children().last()).css("font-weight","bold");if(true===_.isUndefined(this.app._.data.selectedComponents.attribute)||true===_.isNull(this.app._.data.selectedComponents.attribute)){$(e.children().first()).attr("checked",true)}d.append(e);h.addList(this.app._.data.components.attributes).sortAscendingBy("__cv_niceLabel").each(function(j){e=$(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialogRadioElement").html(),{__cv_niceLabel:j.__cv_niceLabel,__cv_uri:j.__cv_uri,radioCSSClass:"cubeviz-dataSelectionModule-attributeRadio",radioName:"cubeviz-dataSelectionModule-attributeRadio",radioValue:j.__cv_uri}));d.append(e)});this.bindUserInterfaceEvents({"click #cubeviz-attribute-dialogOpener":this.onClick_dialogOpener});$("#cubeviz-attribute-dialogOpener").show()}}else{$("#cubeviz-attribute-dialogOpener").hide()}this.triggerGlobalEvent("onAfterRender_attribute");this.bindUserInterfaceEvents({"click #cubeviz-attributeAndMeasure-questionmark":this.onClick_questionmark});return this};return b})(CubeViz_View_Abstract);var View_DataselectionModule_Component=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_CubeVizModule_Component",c,d);this.bindGlobalEvents([{name:"onStart_application",handler:this.onStart_application},{name:"onChange_selectedDS",handler:this.onChange_selectedDS},{name:"onChange_selectedSlice",handler:this.onChange_selectedSlice}])}a.prototype.configureSetupComponentDialog=function(d,g,f){var c=this;$("#cubeviz-dataSelectionModule-dialogContainer").append(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialog").html(),{__cv_niceLabel:d.__cv_niceLabel,__cv_hashedUri:d.__cv_hashedUri,__cv_description:d.__cv_description,__cv_shortDescription:$("#cubeviz-dataSelectionModule-tra-componentDialogDescription").html(),__cv_title:$("#cubeviz-dataSelectionModule-tra-componentDialogMainTitle").html()}));var e=$("#cubeviz-dataSelectionModule-dialog-"+d.__cv_hashedUri);if(true==_.str.isBlank(d.__cv_description)){$(e.find(".cubeviz-dataSelectionModule-dialog-description").get(0)).hide()}e.data("componentBox",g).data("component",d);CubeViz_View_Helper.attachDialogTo(e);$(e.find(".cubeviz-dataSelectionModule-selectAllButton").get(0)).data("dialogDiv",e);$(e.find(".cubeviz-dataSelectionModule-deselectButton").get(0)).data("dialogDiv",e);f.data("dialogDiv",e);$($(e.find(".cubeviz-dataSelectionModule-cancelBtn")).get(0)).data("dialogDiv",e);$($(e.find(".cubeviz-dataSelectionModule-closeAndUpdateBtn")).get(0)).data("dialogDiv",e).on("click",$.proxy(this.onClick_closeAndUpdate,this));$($(e.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(0)).data("dialogDiv",e).data("type","alphabet");$($(e.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(1)).data("dialogDiv",e).data("type","check status");$($(e.find(".cubeviz-dataSelectionModule-dialogSortButtons")).children().get(2)).data("dialogDiv",e).data("type","observation count");this.configureSetupComponentElements(d)};a.prototype.configureSetupComponentElements=function(k){var f=null;var j=$("#cubeviz-dataSelectionModule-dialog-"+k.__cv_hashedUri);var i={};var h=new CubeViz_Collection("__cv_uri");var g=$(j.find(".cubeviz-dataSelectionModule-dialogElements")[0]);var e=this.app._.data.selectedComponents.dimensions[k.__cv_uri].__cv_elements;var l=this;var d=null;var c=false;h.addList(k.__cv_elements).sortAscendingBy("__cv_niceLabel").each(function(m){d=undefined!==_.find(e,function(n){return false===_.isUndefined(n)?n.__cv_uri==m.__cv_uri:false});if(true===d){c=true}i=$(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-dialogCheckboxElement").html(),{__cv_niceLabel:m.__cv_niceLabel,__cv_uri:m.__cv_uri,__cv_uri2:m.__cv_uri}));f=i.children().first();if(true==d){f.attr("checked",true)}$(f).on("click",$.proxy(l.onClick_dimensionElementCheckbox,l));i.data("data",m).data("dialogDiv",j);g.append(i)})};a.prototype.destroy=function(){_.each(this.collection._,function(c){$("#cubeviz-dataSelectionModule-dialog-"+c.__cv_hashedUri).dialog("destroy");$("#cubeviz-dataSelectionModule-dialog-"+c.__cv_hashedUri).remove()});b.prototype.destroy.call(this);CubeViz_View_Helper.destroyDialog($("#cubeviz-component-dialog"));return this};a.prototype.initialize=function(){this.collection.reset("__cv_hashedUri");this.collection.addList(this.app._.data.components.dimensions);this.render()};a.prototype.loadComponentDimensions=function(d){var c=this;DataCube_Component.loadAllDimensions(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.data.selectedDSD.__cv_uri,this.app._.data.selectedDS.__cv_uri,function(e){c.app._.data.components.dimensions=e;c.app._.data.selectedComponents.dimensions=DataCube_Component.getDefaultSelectedDimensions(e);c.collection.reset("__cv_hashedUri").addList(e);d()})};a.prototype.onChange_selectedDS=function(d,e){var c=this;this.destroy();this.loadComponentDimensions(function(){c.app._.backend.dataHash=CryptoJS.MD5(JSON.stringify(c.app._.data))+"";CubeViz_ConfigurationLink.saveData(c.app._.backend.url,c.app._.backend.serviceUrl,c.app._.backend.modelUrl,c.app._.backend.dataHash,c.app._.data,function(){DataCube_Observation.loadAll(c.app._.backend.url,c.app._.backend.serviceUrl,c.app._.backend.modelUrl,c.app._.backend.dataHash,"",function(f){c.app._.data.retrievedObservations=f;CubeViz_View_Helper.hideLeftSidebarSpinner();c.render();e.callback()})})})};a.prototype.onChange_selectedSlice=function(g,h){if(0===_.size(this.app._.data.selectedSlice)){}else{var i=null;var f=null;var e="";var c="";var d=this;_.each(this.app._.data.components.dimensions,function(j){e=j["http://purl.org/linked-data/cube#dimension"];c=d.app._.data.selectedSlice[e];if(false===_.str.isBlank(c)){_.each(j.__cv_elements,function(k){if(k.__cv_uri==c){d.app._.data.selectedComponents.dimensions[j.__cv_uri].__cv_elements={0:k}}})}});this.app._.data.numberOfMultipleDimensions=_.size(CubeViz_Visualization_Controller.getMultipleDimensions(this.app._.data.selectedComponents.dimensions));this.app._.data.numberOfOneElementDimensions=_.size(CubeViz_Visualization_Controller.getOneElementDimensions(this.app._.data.selectedComponents.dimensions));this.destroy().initialize();this.loadComponentDimensions(function(){d.app._.backend.dataHash=CryptoJS.MD5(JSON.stringify(d.app._.backend.data))+"";CubeViz_ConfigurationLink.saveData(d.app._.backend.url,d.app._.backend.serviceUrl,d.app._.backend.modelUrl,d.app._.backend.dataHash,d.app._.data,function(){DataCube_Observation.loadAll(d.app._.backend.url,d.app._.backend.serviceUrl,d.app._.backend.modelUrl,d.app._.backend.dataHash,"",function(j){d.app._.data.retrievedObservations=j;CubeViz_View_Helper.hideLeftSidebarSpinner();d.render();h.callback()})})})}};a.prototype.onClick_cancel=function(c){CubeViz_View_Helper.closeDialog($(c.target).data("dialogDiv"))};a.prototype.onClick_dimensionElementCheckbox=function(e){var f=$(e.target);var h=$($(e.target).parent());var d=h.data("dialogDiv").find('[type="checkbox"]');var c=false;var g=$(h.data("dialogDiv")).data("component").__cv_selectedElementCount;if(1<g||1==this.app._.data.numberOfMultipleDimensions){return}_.each(d,function(i){if($(i).attr("checked")){c=true}});if(false==c){_.each(d,function(i){$(i).attr("disabled",false)});$(h.data("dialogDiv").find(".cubeviz-dataSelectionModule-selectAllButton").get(0)).show();$(h.data("dialogDiv").find(".cubeviz-dataSelectionModule-deselectButton").get(0)).show()}else{_.each(d,function(i){if(!$(i).attr("checked")){$(i).attr("disabled",true)}});$(h.data("dialogDiv").find(".cubeviz-dataSelectionModule-selectAllButton").get(0)).hide();$(h.data("dialogDiv").find(".cubeviz-dataSelectionModule-deselectButton").get(0)).hide()}};a.prototype.onClick_closeAndUpdate=function(e){var d=$(e.target).data("dialogDiv");var c=this;CubeViz_View_Helper.showCloseAndUpdateSpinner(d);this.readAndSaveSetupComponentDialogChanges(d,function(){if(true===cubeVizApp._.backend.uiParts.index.isLoaded){c.triggerGlobalEvent("onReRender_visualization")}c.triggerGlobalEvent("onUpdate_componentDimensions");CubeViz_View_Helper.hideCloseAndUpdateSpinner(d);CubeViz_View_Helper.closeDialog(d)})};a.prototype.onClick_deselectButton=function(c){$(c.target).data("dialogDiv").find('[type="checkbox"]').attr("checked",false)};a.prototype.onClick_selectAllButton=function(c){$(c.target).data("dialogDiv").find('[type="checkbox"]').attr("checked",true)};a.prototype.onClick_setupComponentOpener=function(c){this.triggerGlobalEvent("onClick_setupComponentOpener");var e=$($(c.target).data("dialogDiv")).data("component").__cv_selectedElementCount;var d=$(c.target).data("dialogDiv").find('[type="checkbox"]');if(1==e&&2==this.app._.data.numberOfMultipleDimensions&&2<_.size(this.app._.data.components.dimensions)){_.each(d,function(f){if(!$(f).attr("checked")){$(f).attr("disabled",true)}});$($(c.target).data("dialogDiv").find(".cubeviz-dataSelectionModule-selectAllButton").get(0)).hide();$($(c.target).data("dialogDiv").find(".cubeviz-dataSelectionModule-deselectButton").get(0)).hide()}else{_.each(d,function(f){$(f).attr("disabled",false)});$($(c.target).data("dialogDiv").find(".cubeviz-dataSelectionModule-selectAllButton").get(0)).show();$($(c.target).data("dialogDiv").find(".cubeviz-dataSelectionModule-deselectButton").get(0)).show()}CubeViz_View_Helper.openDialog($(c.target).data("dialogDiv"))};a.prototype.onClick_sortButton=function(e){var d=$(e.target).data("dialogDiv");if(true===_.isUndefined(d)){return}var h=d.data("dimensionTypeUrl");var g=$(d.find(".cubeviz-dataSelectionModule-dialogElements").first());var f=g.children("li");var c=[];$(e.target).data("dialogDiv").find(".cubeviz-component-sortButton").removeClass("cubeviz-dataSelectionModule-dialogSortButtonSelected");$(e.target).addClass("cubeviz-dataSelectionModule-dialogSortButtonSelected");switch($(e.target).data("type")){case"alphabet":c=CubeViz_View_Helper.sortLiItemsByAlphabet(f);break;case"check status":c=CubeViz_View_Helper.sortLiItemsByCheckStatus(f);break;case"observation count":c=CubeViz_View_Helper.sortLiItemsByObservationCount(f,h,this.app._.data.retrievedObservations);break;default:return}g.empty();_.each(c,function(i){g.append(i)})};a.prototype.onClick_questionmark=function(d){$("#cubeviz-dataSelectionModule-dialogContainer").append(CubeViz_View_Helper.tplReplace($("#cubeviz-dataSelectionModule-tpl-helpDialog").html(),{__cv_id:"component",__cv_niceLabel:$("#cubeviz-dataSelectionModule-tra-componentHelpDialogTitle").html(),__cv_description:$("#cubeviz-dataSelectionModule-tra-componentHelpDialogDescription").html()}));var c=$("#cubeviz-dataSelectionModule-helpDialog-component");CubeViz_View_Helper.attachDialogTo(c,{closeOnEscape:true,showCross:true,width:500});CubeViz_View_Helper.openDialog(c)};a.prototype.readAndSaveSetupComponentDialogChanges=function(g,j){var f=g.find(".cubeviz-dataSelectionModule-dialogElements").children();var c=g.data("componentBox");var h=g.data("component");var i=null;var d=null;var e=new CubeViz_Collection("__cv_uri");var k=this;if(true===_.isUndefined(h)){return}_.each(f,function(l){i=$($(l).children().get(0));d=$($(l).children().get(1));if("checked"===i.attr("checked")){e.add($(l).data("data"))}});this.app._.data.selectedComponents.dimensions[h.__cv_uri].__cv_elements=e.toObject();$(c.find(".cubeviz-component-selectedCount").get(0)).html(e.size());g.data("component").__cv_selectedElementCount=e.size();this.app._.data.numberOfMultipleDimensions=_.size(CubeViz_Visualization_Controller.getMultipleDimensions(this.app._.data.selectedComponents.dimensions));this.app._.data.numberOfOneElementDimensions=_.size(CubeViz_Visualization_Controller.getOneElementDimensions(this.app._.data.selectedComponents.dimensions));if(true===_.isUndefined(this.app._.data.settings)){this.app._.backend.dataHash=CryptoJS.MD5(JSON.stringify(this.app._.data))+"";CubeViz_ConfigurationLink.saveData(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.backend.dataHash,this.app._.data,function(){DataCube_Observation.loadAll(k.app._.backend.url,k.app._.backend.serviceUrl,k.app._.backend.modelUrl,k.app._.backend.dataHash,"",function(l){k.app._.data.retrievedObservations=l;j()})})}else{if(false===_.isUndefined(this.app._.data.settings)&&false===_.isUndefined(this.app._.data.settings.synchronizeWithStore)&&false===this.app._.data.settings.synchronizeWithStore){k.app._.data.retrievedObservations=DataCube_Observation.markActiveObservations(k.app._.data.retrievedObservations,this.app._.data.selectedComponents.dimensions,this.app._.data.selectedComponents.measure,this.app._.data.selectedComponents.attribute);this.app._.backend.dataHash=CryptoJS.MD5(JSON.stringify(this.app._.data))+"";CubeViz_ConfigurationLink.saveData(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.backend.dataHash,this.app._.data,function(){j()},true)}}};a.prototype.onComplete_loadDS=function(c,d){this.onChange_selectedDS(c,d)};a.prototype.onComplete_loadObservations=function(d,c){this.app._.data.retrievedObservations=c};a.prototype.onStart_application=function(){this.initialize()};a.prototype.render=function(){this.triggerGlobalEvent("onBeforeRender_component");var e=this.collection._;var h=$("#cubviz-component-listBox");var i=null;var c=this.app._.data.selectedComponents.dimensions;var f=null;var d=this;var g=null;this.collection.reset();_.each(e,function(j){if(false===_.isUndefined(c)){f=c[j.__cv_uri];j.__cv_selectedElementCount=_.keys(f.__cv_elements).length}else{j.__cv_selectedElementCount=1}j.__cv_elementCount=_.size(j.__cv_elements);j.__cv_shortLabel=_.str.prune(j.__cv_niceLabel,23,"..");j.__cv_shortDescription=_.str.prune(j.__cv_description,38,"..");i=$(CubeViz_View_Helper.tplReplace($("#cubeviz-component-tpl-listBoxItem").html(),j));if(1===j.__cv_elementCount){$(i.find(".cubeviz-component-setupComponentOpener").get(0)).hide();$(i.find(".cubeviz-component-selectedElementsBlock").get(0)).hide()}$(i.find(".cubeviz-component-setupComponentOpener").get(0)).data("dimension",j);h.append(i);d.configureSetupComponentDialog(j,i,$(i.find(".cubeviz-component-setupComponentOpener").get(0)));$(i.find(".cubeviz-component-selectedCount").get(0)).html(j.__cv_selectedElementCount);d.collection.add(j)});this.bindUserInterfaceEvents({"click .cubeviz-component-setupComponentOpener":this.onClick_setupComponentOpener,"click #cubeviz-component-questionmark":this.onClick_questionmark,"click .cubeviz-dataSelectionModule-cancelBtn":this.onClick_cancel,"click .cubeviz-dataSelectionModule-deselectButton":this.onClick_deselectButton,"click .cubeviz-dataSelectionModule-selectAllButton":this.onClick_selectAllButton,"click .cubeviz-dataSelectionModule-dialogSortButtons":this.onClick_sortButton});this.triggerGlobalEvent("onAfterRender_component");return this};return a})(CubeViz_View_Abstract);var View_DataselectionModule_Footer=(function(a){__extends(b,a);function b(c,d){a.call(this,"View_CubeVizModule_Footer",c,d);this.bindGlobalEvents([{name:"onAfterChange_selectedDSD",handler:this.onAfterChange_selectedDSD},{name:"onBeforeClick_selectorItem",handler:this.onBeforeClick_selectorItem},{name:"onChange_selectedDS",handler:this.onChange_selectedDS},{name:"onStart_application",handler:this.onStart_application},{name:"onUpdate_componentDimensions",handler:this.onUpdate_componentDimensions}])}b.prototype.changePermaLinkButton=function(){if(true==_.isUndefined(this.collection.get("buttonVal"))){this.collection.add({id:"buttonVal",value:$("#cubeviz-footer-permaLinkButton").html()});this.showLink()}else{this.collection.remove("buttonVal");this.closeLink()}};b.prototype.closeLink=function(){$("#cubeviz-footer-permaLinkMenu").fadeOut("slow")};b.prototype.initialize=function(){this.collection.add({id:"cubeviz-footer-permaLink",html:$("#cubeviz-footer-permaLink").html()});this.render()};b.prototype.onAfterChange_selectedDSD=function(){if(false===_.isUndefined(this.collection.get("buttonVal"))){this.changePermaLinkButton()}};b.prototype.onBeforeClick_selectorItem=function(){if(true==_.isUndefined(this.collection.get("buttonVal"))){}else{var c=this.collection.get("buttonVal").value;this.collection.remove("buttonVal");this.closeLink()}};b.prototype.onChange_selectedDS=function(){this.onAfterChange_selectedDSD()};b.prototype.onClick_permaLinkButton=function(c){this.changePermaLinkButton()};b.prototype.onClick_showVisualization=function(d){var c=this;this.app._.backend.dataHash=CryptoJS.MD5(JSON.stringify(this.app._.data))+"";if(true===cubeVizApp._.backend.uiParts.index.isLoaded){CubeViz_ConfigurationLink.saveData(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.backend.dataHash,this.app._.data,function(){DataCube_Observation.loadAll(c.app._.backend.url,c.app._.backend.serviceUrl,c.app._.backend.modelUrl,c.app._.backend.dataHash,"",function(e){c.app._.data.retrievedObservations=e;c.triggerGlobalEvent("onReRender_visualization")})})}else{this.app._.backend.dataHash=CryptoJS.MD5(JSON.stringify(this.app._.data))+"";CubeViz_ConfigurationLink.saveData(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.backend.dataHash,this.app._.data,function(){c.app._.backend.uiHash=CryptoJS.MD5(JSON.stringify(c.app._.ui))+"";CubeViz_ConfigurationLink.saveUI(c.app._.backend.url,c.app._.backend.serviceUrl,c.app._.backend.modelUrl,c.app._.backend.uiHash,c.app._.ui,function(){window.location.href=c.app._.backend.url+"?m="+encodeURIComponent(c.app._.backend.modelUrl)+"&cv_dataHash="+c.app._.backend.dataHash+"&cv_uiHash="+c.app._.backend.uiHash})},true)}};b.prototype.onStart_application=function(){this.initialize()};b.prototype.onUpdate_componentDimensions=function(){if(true==_.isUndefined(this.collection.get("buttonVal"))){}else{var c=this.collection.get("buttonVal").value;this.collection.remove("buttonVal");this.closeLink()}};b.prototype.render=function(){this.bindUserInterfaceEvents({"click #cubeviz-footer-permaLinkButton":this.onClick_permaLinkButton,"click #cubeviz-footer-showVisualizationButton":this.onClick_showVisualization});return this};b.prototype.showLink=function(){var c=this;this.app._.backend.dataHash=CryptoJS.MD5(JSON.stringify(this.app._.data))+"";CubeViz_ConfigurationLink.saveData(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.backend.dataHash,this.app._.data,function(){c.app._.backend.uiHash=CryptoJS.MD5(JSON.stringify(c.app._.ui))+"";CubeViz_ConfigurationLink.saveUI(c.app._.backend.url,c.app._.backend.serviceUrl,c.app._.backend.modelUrl,c.app._.backend.uiHash,c.app._.ui,function(){var f=c.app._.backend.url+"?";if(false==_.str.isBlank(c.app._.backend.serviceUrl)){f+="serviceUrl="+encodeURIComponent(c.app._.backend.serviceUrl)+"&"}f+="m="+encodeURIComponent(c.app._.backend.modelUrl)+"&cv_dataHash="+c.app._.backend.dataHash+"&cv_uiHash="+c.app._.backend.uiHash;var d=$("<a></a>").attr("href",f).attr("target","_self").html(c.collection.get("cubeviz-footer-permaLink").html);$("#cubeviz-footer-permaLink").html(d);var e=$("#cubeviz-footer-permaLinkButton").position();$("#cubeviz-footer-permaLinkMenu").css("top",(e.top+30)).css("left",(e.left)).fadeIn("slow")})},true)};return b})(CubeViz_View_Abstract);var View_IndexAction_ExportArea=(function(a){__extends(b,a);function b(c,d){a.call(this,"View_IndexAction_ExportArea",c,d);this.bindGlobalEvents([{name:"onReRender_visualization",handler:this.onReRender_visualization},{name:"onStart_application",handler:this.onStart_application},{name:"onUpdate_componentDimensions",handler:this.onUpdate_componentDimensions}])}b.prototype.destroy=function(){a.prototype.destroy.call(this);return this};b.prototype.initialize=function(){this.render()};b.prototype.onReRender_visualization=function(){this.initialize()};b.prototype.onStart_application=function(){this.initialize()};b.prototype.onUpdate_componentDimensions=function(){this.initialize()};b.prototype.render=function(){this.setUrlToDownload();return this};b.prototype.setUrlToDownload=function(){var c=this.app._.backend.url+"export/dataselection/"+this.app._.backend.dataHash+"/?serviceUrl="+encodeURIComponent(this.app._.backend.serviceUrl);$("#cubeviz-index-exportArea-btnTurtle").attr("href",c);$("#cubeviz-index-exportArea-btnCsv").attr("href",c+"&type=csv")};return b})(CubeViz_View_Abstract);var View_IndexAction_Header=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_IndexAction_Header",c,d);this.bindGlobalEvents([{name:"onChange_selectedDS",handler:this.onChange_selectedDS},{name:"onStart_application",handler:this.onStart_application}])}a.prototype.destroy=function(){b.prototype.destroy.call(this);CubeViz_View_Helper.destroyDialog($("#cubeviz-index-headerDialogBox"));return this};a.prototype.initialize=function(){this.render()};a.prototype.onChange_selectedDS=function(){if(false===this.app._.backend.uiSettings.useDataSetInsteadOfModel){$("#cubeviz-index-headerSubheadline").html(CubeViz_View_Helper.tplReplace($("#cubeviz-index-tpl-headerSubheadline").html(),{selectedDataSet:this.app._.data.selectedDS.__cv_niceLabel}))}else{$("#cubeviz-index-header").html(CubeViz_View_Helper.tplReplace($("#cubeviz-index-tpl-headerSubheadline").html(),{selectedDataSet:this.app._.data.selectedDS.__cv_niceLabel}))}};a.prototype.onClick_questionMark=function(){$("#cubeviz-index-headerDialogBox").dialog("open")};a.prototype.onStart_application=function(){this.initialize()};a.prototype.render=function(){CubeViz_View_Helper.attachDialogTo($("#cubeviz-index-headerDialogBox"),{closeOnEscape:true,height:450,showCross:true,width:"50%"});this.renderHeader();this.renderDialogBox();this.bindUserInterfaceEvents({"click #cubeviz-index-headerQuestionMarkHeadline":this.onClick_questionMark});return this};a.prototype.renderDialogBox=function(){var d="";if(false===_.isUndefined(this.app._.backend.modelInformation["http://www.w3.org/2000/01/rdf-schema#label"])&&false===_.str.isBlank(this.app._.backend.modelInformation["http://www.w3.org/2000/01/rdf-schema#label"])){d=this.app._.backend.modelInformation["http://www.w3.org/2000/01/rdf-schema#label"].content}else{d=this.app._.backend.modelUrl}$("#cubeviz-index-headerDialogBox").html(CubeViz_View_Helper.tplReplace($("#cubeviz-index-tpl-headerDialogBoxHead").html(),{label:d}));var c=$($("#cubeviz-index-headerDialogBox").children().last());_.each(this.app._.backend.modelInformation,function(e){c.append(CubeViz_View_Helper.tplReplace($("#cubeviz-index-tpl-headerDialogBoxEntry").html(),{predicateLabel:e.predicateLabel,objectContent:CubeViz_Visualization_Controller.linkify(e.content)}))})};a.prototype.renderHeader=function(){var c;if(false===_.isUndefined(this.app._.backend.modelInformation["http://www.w3.org/2000/01/rdf-schema#label"])&&false===_.str.isBlank(this.app._.backend.modelInformation["http://www.w3.org/2000/01/rdf-schema#label"])){c=this.app._.backend.modelInformation["http://www.w3.org/2000/01/rdf-schema#label"].content}else{c=this.app._.backend.modelUrl}if(false===this.app._.backend.uiSettings.useDataSetInsteadOfModel){$("#cubeviz-index-header").html(CubeViz_View_Helper.tplReplace($("#cubeviz-index-tpl-header").html(),{modelLabel:c}));$("#cubeviz-index-headerSubheadline").html(CubeViz_View_Helper.tplReplace($("#cubeviz-index-tpl-headerSubheadline").html(),{selectedDataSet:this.app._.data.selectedDS.__cv_niceLabel})+$("#cubeviz-index-tpl-headerSubheadlineButtons").html())}else{$("#cubeviz-index-header").html(CubeViz_View_Helper.tplReplace($("#cubeviz-index-tpl-headerSubheadline").html(),{selectedDataSet:this.app._.data.selectedDS.__cv_niceLabel}));$("#cubeviz-index-headerSubheadline").html($("#cubeviz-index-tpl-headerSubheadlineButtons").html())}};return a})(CubeViz_View_Abstract);var View_IndexAction_Legend=(function(a){__extends(b,a);function b(c,d){a.call(this,"View_IndexAction_Legend",c,d);this.bindGlobalEvents([{name:"onUpdate_componentDimensions",handler:this.onUpdate_componentDimensions},{name:"onStart_application",handler:this.onStart_application}])}b.prototype.destroy=function(){$("#cubeviz-legend-btnShowRetrievedObservations").off();$("#cubeviz-legend-dataSet").html("");$("#cubeviz-legend-observations").html("");$("#cubeviz-legend-configurationList").html("");CubeViz_View_Helper.destroyDialog($("#cubeviz-legend-componentDimensionInfoDialog"));a.prototype.destroy.call(this);return this};b.prototype.displayDataset=function(f,e){var c=this;var d=null;$("#cubeviz-legend-dsLabel").html('<a href="'+f.__cv_uri+'" target="_blank">'+f.__cv_niceLabel+"</a>");$("#cubeviz-legend-dsProperties").html('<tr class="info"><td><strong>Property</strong></td><td><strong>Value</strong></td></tr>');$("#cubeviz-legend-dsProperties").append('<tr><td>URI</td><td style="word-break:break-all;"><a href="'+f.__cv_uri+'" target="_blank">'+f.__cv_uri+"</a></td></tr>");_.each(f,function(i,h){if(false===_.str.include(h,"__cv_")){if("http://purl.org/linked-data/cube#structure"==h){i='<a href="'+e.__cv_uri+'" target="_blank">'+e.__cv_niceLabel+"</a>"}else{if(true===_.isObject(i)||true===_.isArray(i)){var g=new CubeViz_Collection();i=CubeViz_Visualization_Controller.linkify(g.addList(i)._.join(", "))}else{if(true===c.isValidUrl(i)){i='<a href="'+i+'" target="_blank">'+_.str.prune(i,60)+"</a>"}}}$("#cubeviz-legend-dsProperties").append('<tr><td><a href="'+h+'" target="_blank">'+h+'</a></td><td style="word-break:break-all;">'+i+"</td></tr>")}});if(false===_.isNull(f.__cv_sourceDataset)&&false===_.isUndefined(f.__cv_sourceDataset)){_.each(f.__cv_sourceDataset,function(g){$("#cubeviz-legend-dsProperties").append('<tr><td colspan="2"><a name="'+(CryptoJS.MD5(g.__cv_uri)+"").substring(0,6)+'"></a></td></tr><tr class="warning"><td colspan="2"><strong>Source Dataset: <a href="'+g.__cv_uri+'" target="_blank">'+g.__cv_niceLabel+"</a></strong></td></tr>");$("#cubeviz-legend-dsProperties").append('<tr><td>URI</td><td style="word-break:break-all;"><a href="'+g.__cv_uri+'" target="_blank">'+g.__cv_uri+"</a></td></tr>");_.each(g,function(j,i){if(false===_.str.include(i,"__cv_")){if(true===_.isObject(j)||true===_.isArray(j)){var h=new CubeViz_Collection();j=CubeViz_Visualization_Controller.linkify(h.addList(j)._.join(", "))}else{if(true===c.isValidUrl(j)){j='<a href="'+j+'" target="_blank">'+_.str.prune(j,60)+"</a>"}}$("#cubeviz-legend-dsProperties").append('<tr><td><a href="'+i+'" target="_blank">'+i+"</a></td><td>"+j+"</td></tr>")}})})}};b.prototype.displayDataStructureDefinition=function(e){var c=this;var d=null;$("#cubeviz-legend-dsdLabel").html('<a href="'+e.__cv_uri+'" target="_blank">'+e.__cv_niceLabel+"</a>");$("#cubeviz-legend-dsdProperties").html('<tr class="info"><td><strong>Property</strong></td><td><strong>Value</strong></td></tr>');$("#cubeviz-legend-dsdProperties").append('<tr><td>URI</td><td style="word-break:break-all;"><a href="'+e.__cv_uri+'" target="_blank">'+e.__cv_uri+"</a></td></tr>");_.each(e,function(h,g){if(false===_.str.include(g,"__cv_")){if("http://purl.org/linked-data/cube#component"==g){var i=[];var f=new CubeViz_Collection();f.addList(h).each(function(j){_.each(c.app._.data.selectedComponents.dimensions,function(k){if(j===k.__cv_uri){i.push('<i class="icon-anchor" style="font-size: 8px;"></i> <a href="#'+(CryptoJS.MD5(k.__cv_uri)+"").substring(0,6)+'">'+k.__cv_niceLabel+"</a> ")}})});i.push('<i class="icon-anchor" style="font-size: 8px;"></i> <a href="#'+(CryptoJS.MD5(c.app._.data.selectedComponents.measure.__cv_uri)+"").substring(0,6)+'">'+c.app._.data.selectedComponents.measure.__cv_niceLabel+"</a>");if(false===_.isNull(c.app._.data.selectedComponents.attribute)&&false===_.isUndefined(c.app._.data.selectedComponents.attribute)){i.push(c.app._.data.selectedComponents.attribute.__cv_niceLabel)}h=i.join(", ")}else{if(true===_.isObject(h)||true===_.isArray(h)){var f=new CubeViz_Collection();h=CubeViz_Visualization_Controller.linkify(f.addList(h)._.join(", "))}else{if(true===c.isValidUrl(h)){h='<a href="'+h+'" target="_blank">'+_.str.prune(h,60)+"</a>"}}}$("#cubeviz-legend-dsdProperties").append('<tr><td><a href="'+g+'" target="_blank">'+g+'</a></td><td style="word-break:break-all;">'+h+"</td></tr>")}})};b.prototype.displayRetrievedObservations=function(d,g,f){var k="";var h=0;var m="";var o=this;$("#cubeviz-legend-retrievedObservationsTitle").html(DataCube_Observation.getNumberOfActiveObservations(d)+" Retrieved Observations");$("#cubeviz-legend-observations").html("");k="<tr><td></td>";_.each(g,function(i){k+="<td>"+CubeViz_View_Helper.tplReplace($("#cubeviz-legend-tpl-observationsTableHeadEntry").html(),{label:i.__cv_niceLabel,uriHash:(CryptoJS.MD5(i.__cv_uri)+"").substring(0,6)})+"</td>"});k+='<td colspan="2">'+CubeViz_View_Helper.tplReplace($("#cubeviz-legend-tpl-observationsTableHeadEntry").html(),{label:f.__cv_niceLabel,uriHash:(CryptoJS.MD5(f.__cv_uri)+"").substring(0,6)})+"</td>";k+="<td></td></tr>";$("#cubeviz-legend-observations").append(k);_.each(g,function(i){$($("#cubeviz-legend-observations").find(".cubeviz-legend-sortAsc").get(h)).data("dimension",i);$($("#cubeviz-legend-observations").find(".cubeviz-legend-sortDesc").get(h++)).data("dimension",i)});$($("#cubeviz-legend-observations").find(".cubeviz-legend-sortAsc").get(h)).data("measure",f);$($("#cubeviz-legend-observations").find(".cubeviz-legend-sortDesc").get(h)).data("measure",f);var e=DataCube_Observation.getValues(d,f["http://purl.org/linked-data/cube#measure"],true);var l=0;var c="<strong>min:</strong> "+String(jsStats.min(e[0])).substring(0,10);var j="<strong>max:</strong> "+String(jsStats.max(e[0])).substring(0,10);var n=null;k='<tr class="info"><td></td>';_.each(g,function(i){l=_.size(DataCube_Observation.getUsedDimensionElementUris(d,i["http://purl.org/linked-data/cube#dimension"]));if(l<_.size(i.__cv_elements)){k+="<td><strong>"+_.size(i.__cv_elements)+"</strong> different dimension elements available, but only <strong>"+l+"</strong> are in use</td>"}else{k+="<td><strong>"+_.size(i.__cv_elements)+"</strong> different dimension elements are in use</td>"}});k+="<td>"+c+"</td><td>"+j+"</td><td></td>";"</tr>";$("#cubeviz-legend-observations").append(k);var h=1;_.each(d,function(p){if(false===DataCube_Observation.isActive(p)){return}if(false===_.isNull(p.__cv_sourceDataset)&&false===_.isUndefined(p.__cv_sourceDataset)){k='<tr><td rowspan="2"><strong>'+h+++"</strong></td>"}else{k="<tr><td><strong>"+h+++"</strong></td>"}_.each(g,function(q){_.each(q.__cv_elements,function(r){if(r.__cv_uri==p[q["http://purl.org/linked-data/cube#dimension"]]){m=r.__cv_niceLabel}});k+='<td class="cubeviz-legend-dimensionElementLabelTd"><i class="icon-anchor" style="font-size: 8px;"></i> <a href="#'+(CryptoJS.MD5(q.__cv_uri)+"").substring(0,6)+'" title="Anchor to dimension: '+q.__cv_niceLabel+'">'+m+"</a>";k+="</td>"});n=DataCube_Observation.parseValue(p,f["http://purl.org/linked-data/cube#measure"]);if(true===_.isNull(n)){k+='<td class="cubeviz-legend-measureTd" colspan="2" style="background-color: #FFEAEA;"><em><small>no value found or type is not float</small></em></td>'}else{k+='<td class="cubeviz-legend-measureTd" colspan="2">'+n+"</td>"}k+='<td><a href="'+p.__cv_uri+'" target="_blank">Link</a></td>';k+="</tr>";if(false===_.isNull(p.__cv_sourceDataset)&&false===_.isUndefined(p.__cv_sourceDataset)){k+='<tr><td colspan="'+(3+_.size(g))+'" style="padding-top: 2px; padding-bottom: 10px;"><small>Source Dataset: <strong><a href="#'+(CryptoJS.MD5(p.__cv_sourceDataset.__cv_uri)+"").substring(0,6)+'">'+p.__cv_sourceDataset.__cv_niceLabel+'</a></strong></small><br/><small><div class="cubeviz-clickable cubeviz-legend-sourceObservationOpener">Show more information about source Observation <i class="icon-chevron-down"></i></div></small><br/><table class="cubeviz-legend-sourceObservation table table-bordered table-condensed table-striped responsive-utilities"></table></td></tr>'}$("#cubeviz-legend-observations > tbody:last").append(k);$($("#cubeviz-legend-observations").find(".cubeviz-legend-measureTd").last()).data("observation",p);if(false===_.isNull(p.__cv_sourceObservation)&&false===_.isUndefined(p.__cv_sourceObservation)){var i=$($("#cubeviz-legend-observations").find(".cubeviz-legend-sourceObservation").last());i.append('<tr><td>URI</td><td style="word-break:break-all;"><a href="'+p.__cv_sourceObservation.__cv_uri+'" target="_blank">'+p.__cv_sourceObservation.__cv_uri+"</a></td></tr>");_.each(p.__cv_sourceObservation,function(s,r){if(false===_.str.include(r,"__cv_")){if(true===_.isObject(s)||true===_.isArray(s)){var q=new CubeViz_Collection();s=CubeViz_Visualization_Controller.linkify(q.addList(s)._.join(", "))}else{if(true===o.isValidUrl(s)){s='<a href="'+s+'" target="_blank">'+_.str.prune(s,60)+"</a>"}}i.append('<tr><td><a href="'+r+'" target="_blank">'+r+'</a></td><td style="word-break:break-all;">'+s+"</td></tr>")}});i.hide();$($("#cubeviz-legend-observations").find(".cubeviz-legend-sourceObservationOpener").last()).click(function(){i.fadeToggle(200)})}});this.bindUserInterfaceEvents({"dblclick .cubeviz-legend-measureTd":this.onDblClick_measureTd,"click .cubeviz-legend-sortAsc":this.onClick_sortAsc,"click .cubeviz-legend-sortDesc":this.onClick_sortDesc})};b.prototype.displaySelectedDimensions=function(c){var f=new CubeViz_Collection();var d=this;var g=new CubeViz_Collection();var e=null;$("#cubeviz-legend-componentDimensions").html("");_.each(c,function(h){$("#cubeviz-legend-componentDimensions").append($(CubeViz_View_Helper.tplReplace($("#cubeviz-legend-tpl-dimensionBlock").html(),{dimensionLabel:h.__cv_niceLabel,dimensionUri:h.__cv_uri,dimensionUriHash:(CryptoJS.MD5(h.__cv_uri)+"").substring(0,6)})));e=$($("#cubeviz-legend-componentDimensions").find(".table").last());e.append('<tr class="info"><td><strong>Property</strong></td><td><strong>Value</strong></td></tr>');e.append('<tr><td>URI</td><td style="word-break:break-all;"><a href="'+h.__cv_uri+'" target="_blank">'+h.__cv_uri+"</a></td></tr>");_.each(h,function(k,j){if(false===_.str.include(j,"__cv_")){if(true===_.isObject(k)||true===_.isArray(k)){var i=new CubeViz_Collection();k=CubeViz_Visualization_Controller.linkify(i.addList(k)._.join(", "))}else{if(true==d.isValidUrl(k)){k='<a href="'+k+'" target="_blank">'+_.str.prune(k,60)+"</a>"}}e.append('<tr><td><a href="'+j+'">'+j+"</a></td><td>"+k+"</td></tr>")}});g.reset();f.reset().addList(h.__cv_elements).each(function(i){e.append(g.add('<a href="'+i.__cv_uri+'" target="_blank">'+i.__cv_niceLabel+"</a>",null,true))});e.append('<tr><td colspan="2"><strong><em>'+g.size()+' Dimension Elements</em></strong></td></tr><tr><td colspan="2">'+g._.join(", ")+"</td></tr>");if(false===_.isNull(h.__cv_sourceComponentSpecification)&&false===_.isUndefined(h.__cv_sourceComponentSpecification)){_.each(h.__cv_sourceComponentSpecification,function(i){e.append('<tr><td colspan="2"></td></tr><tr class="warning"><td colspan="2"><strong>Source Component Specification: <a href="'+i.__cv_uri+'" target="_blank">'+i.__cv_niceLabel+"</a></strong></td></tr>");e.append('<tr><td>URI</td><td style="word-break:break-all;"><a href="'+i.__cv_uri+'" target="_blank">'+i.__cv_uri+"</a></td></tr>");_.each(i,function(l,k){if(false===_.str.include(k,"__cv_")){if(true===_.isObject(l)||true===_.isArray(l)){var j=new CubeViz_Collection();l=CubeViz_Visualization_Controller.linkify(j.addList(l)._.join(", "))}else{if(true===d.isValidUrl(l)){l='<a href="'+l+'" target="_blank">'+_.str.prune(l,60)+"</a>"}}e.append('<tr><td><a href="'+k+'" target="_blank">'+k+'</a></td><td style="word-break:break-all;">'+l+"</td></tr>")}});g.reset();f.reset().addList(i.__cv_elements).each(function(j){e.append(g.add('<a href="'+j.__cv_uri+'" target="_blank">'+j.__cv_niceLabel+"</a>",null,true))});e.append('<tr><td colspan="2"><em>'+g.size()+' Dimension Elements</em></td></tr><tr><td colspan="2">'+g._.join(", ")+"</td></tr>")})}})};b.prototype.displaySelectedMeasureAndAttribute=function(d,c){var e=this;var f=$("#cubeviz-legend-componentMeasureProperties");$("#cubeviz-legend-componentMeasureLabel").html('<a name="'+(CryptoJS.MD5(d.__cv_uri)+"").substring(0,6)+'"><a href="'+d.__cv_uri+'">'+d.__cv_niceLabel+"</a></a>");f.append('<tr class="info"><td><strong>Property</strong></td><td><strong>Value</strong></td></tr>');_.each(d,function(i,h){if(false===_.str.include(h,"__cv_")){if(true===_.isObject(i)||true===_.isArray(i)){var g=new CubeViz_Collection();i=CubeViz_Visualization_Controller.linkify(g.addList(i)._.join(", "))}else{if(true==e.isValidUrl(i)){i='<a href="'+i+'" target="_blank">'+_.str.prune(i,60)+"</a>"}}f.append('<tr><td><a href="'+h+'">'+h+"</a></td><td>"+i+"</td></tr>")}});if(false===_.isNull(d.__cv_sourceComponentSpecification)&&false===_.isUndefined(d.__cv_sourceComponentSpecification)){_.each(d.__cv_sourceComponentSpecification,function(g){f.append('<tr><td colspan="2"></td></tr><tr class="warning"><td colspan="2"><strong>Source Measure: <a href="'+g.__cv_uri+'" target="_blank">'+g.__cv_niceLabel+"</a></strong></td></tr>");f.append('<tr><td>URI</td><td style="word-break:break-all;"><a href="'+g.__cv_uri+'" target="_blank">'+g.__cv_uri+"</a></td></tr>");_.each(g,function(j,i){if(false===_.str.include(i,"__cv_")){if(true===_.isObject(j)||true===_.isArray(j)){var h=new CubeViz_Collection();j=CubeViz_Visualization_Controller.linkify(h.addList(j)._.join(", "))}else{if(true===e.isValidUrl(j)){j='<a href="'+j+'" target="_blank">'+_.str.prune(j,60)+"</a>"}}f.append('<tr><td><a href="'+i+'" target="_blank">'+i+'</a></td><td style="word-break:break-all;">'+j+"</td></tr>")}})})}if(true===_.isNull(c)||true===_.isUndefined(c)){$("#cubeviz-legend-componentAttribute").hide()}else{$("#cubeviz-legend-componentAttributeLabel").html('<a href="'+d.__cv_uri+'">'+c.__cv_niceLabel+"</a>");$("#cubeviz-legend-componentAttributeProperties").append('<tr class="info"><td><strong>Property</strong></td><td><strong>Value</strong></td></tr>');_.each(c,function(i,h){if(false===_.str.include(h,"__cv_")){if(true===_.isObject(i)||true===_.isArray(i)){var g=new CubeViz_Collection();i=CubeViz_Visualization_Controller.linkify(g.addList(i)._.join(", "))}else{if(true==e.isValidUrl(i)){i='<a href="'+i+'" target="_blank">'+_.str.prune(i,60)+"</a>"}}$("#cubeviz-legend-componentAttributeProperties").append('<tr><td><a href="'+h+'">'+h+"</a></td><td>"+i+"</td></tr>")}})}};b.prototype.initialize=function(){this.render()};b.prototype.isValidUrl=function(c){return((new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)*[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i")).test(c))&&(true===_.str.include(c,".")||true===_.str.include(c,"/"))};b.prototype.onClick_adaptedMeasureValueSaveBtn=function(i){var g=$(i.target).data("observation");var f=this;var c=$(i.target).data("inputField");var d=$(i.target).data("measureTd");var h=$(i.target);g.__cv_temporaryNewValue=c.val();_.each(this.app._.data.retrievedObservations,function(e,j){if(e.__cv_uri===g.__cv_uri){f.app._.data.retrievedObservations[j]=g}});this.restoreMeasureTd(d);this.triggerGlobalEvent("onReRender_visualization")};b.prototype.onClick_btnShowRetrievedObservations=function(c){c.preventDefault();$("#cubeviz-legend-retrievedObservations").slideToggle("slow");return false};b.prototype.onClick_btnShowSelectedConfiguration=function(c){c.preventDefault();$("#cubeviz-legend-selectedConfiguration").slideToggle("slow");return false};b.prototype.onClick_componentDimensionShowInfo=function(f){f.preventDefault();var e=$(f.target);var h=e.data("dimension");var g=e.data("dimensionElement");var c=e.data("observationIcon");var d=$($("#cubeviz-legend-tpl-componentDimensionInfoList").html());_.each(g,function(j,i){if(false===_.str.startsWith(i,"__cv_")){d.append(CubeViz_View_Helper.tplReplace($("#cubeviz-legend-tpl-componentDimensionInfoListEntry").html(),{key:i,value:CubeViz_Visualization_Controller.linkify(j)}))}});$("#cubeviz-legend-componentDimensionInfoDialog").html("").append(CubeViz_View_Helper.tplReplace($("#cubeviz-legend-tpl-componentDimensionInfoHeader").html(),g)).append(d).fadeIn("slow");$("#cubeviz-legend-componentDimensionInfoDialog").dialog("open");return false};b.prototype.onClick_sortAsc=function(c){if(false===_.isUndefined($(c.target).data("dimension"))){this.app._.data.retrievedObservations=this.sortDimensionsAscOrDesc($(c.target).data("dimension"),this.app._.data.retrievedObservations,-1,1)}else{if(false===_.isUndefined($(c.target).data("measure"))){this.app._.data.retrievedObservations=this.sortMeasureValuesAscOrDesc($(c.target).data("measure"),this.app._.data.retrievedObservations,-1,1)}else{return}}this.displayRetrievedObservations(this.app._.data.retrievedObservations,this.app._.data.selectedComponents.dimensions,this.app._.data.selectedComponents.measure)};b.prototype.onClick_sortDesc=function(c){if(false===_.isUndefined($(c.target).data("dimension"))){this.app._.data.retrievedObservations=this.sortDimensionsAscOrDesc($(c.target).data("dimension"),this.app._.data.retrievedObservations,1,-1)}else{if(false===_.isUndefined($(c.target).data("measure"))){this.app._.data.retrievedObservations=this.sortMeasureValuesAscOrDesc($(c.target).data("measure"),this.app._.data.retrievedObservations,1,-1)}else{return}}this.displayRetrievedObservations(this.app._.data.retrievedObservations,this.app._.data.selectedComponents.dimensions,this.app._.data.selectedComponents.measure)};b.prototype.onDblClick_measureTd=function(i){if(true===_.isUndefined($(i.target).data("observation"))||true===_.isNull($(i.target).data("observation"))){return}var f=$(i.target).data("observation");var d=null;var h=this.app._.data.selectedComponents.measure["http://purl.org/linked-data/cube#measure"];if(false===_.isUndefined(f.__cv_temporaryNewValue)){d=f.__cv_temporaryNewValue}else{d=f[h]}var c=$('<input type="text" value="'+d+'">');var g=$('<div class="btn btn-primary" style="vertical-align: top;">Save</div>');$(i.target).html("").append(c).append(g);g.data("inputField",c).data("measureTd",$(i.target)).data("observation",f).on("click",$.proxy(this.onClick_adaptedMeasureValueSaveBtn,this));c.focus()};b.prototype.onUpdate_componentDimensions=function(){this.destroy();this.initialize()};b.prototype.onStart_application=function(){this.initialize()};b.prototype.render=function(){var d=this.app._.data.selectedComponents.measure["http://purl.org/linked-data/cube#measure"];var c=this;this.displayDataStructureDefinition(this.app._.data.selectedDSD);this.displayDataset(this.app._.data.selectedDS,this.app._.data.selectedDSD);this.displaySelectedDimensions(this.app._.data.selectedComponents.dimensions);this.displaySelectedMeasureAndAttribute(this.app._.data.selectedComponents.measure,this.app._.data.selectedComponents.attribute);this.displayRetrievedObservations(this.sortMeasureValuesAscOrDesc(this.app._.data.selectedComponents.measure,this.app._.data.retrievedObservations,-1,1),this.app._.data.selectedComponents.dimensions,this.app._.data.selectedComponents.measure);CubeViz_View_Helper.attachDialogTo($("#cubeviz-legend-componentDimensionInfoDialog"),{closeOnEscape:true,showCross:true,height:450,width:"50%"});$("#cubeviz-legend-btnShowRetrievedObservations").off();$("#cubeviz-legend-btnShowSelectedConfiguration").off();$(".cubeviz-legend-componentDimensionShowInfo").off();$("#cubeviz-legend-sortByTitle").off();$("#cubeviz-legend-sortByValue").off();this.bindUserInterfaceEvents({"click #cubeviz-legend-btnShowSelectedConfiguration":this.onClick_btnShowSelectedConfiguration,"click #cubeviz-legend-btnShowRetrievedObservations":this.onClick_btnShowRetrievedObservations,"click .cubeviz-legend-componentDimensionShowInfo":this.onClick_componentDimensionShowInfo});return this};b.prototype.restoreMeasureTd=function(d){var c=d.data("observation");var e=this.app._.data.selectedComponents.measure["http://purl.org/linked-data/cube#measure"];d.html(c.__cv_temporaryNewValue+" &nbsp; <small>(Original: "+c[e]+")")};b.prototype.sortDimensionsAscOrDesc=function(i,j,g,f){var h="";var e="";var d=new CubeViz_Collection("__cv_uri");var c=i["http://purl.org/linked-data/cube#dimension"];d.addList(j);d._.sort(function(k,l){h=DataCube_Component.findDimensionElement(i.__cv_elements,k[c]).__cv_niceLabel;e=DataCube_Component.findDimensionElement(i.__cv_elements,l[c]).__cv_niceLabel;return h<e?g:f});return d.toObject()};b.prototype.sortMeasureValuesAscOrDesc=function(i,j,h,f){var d=null;var e=new CubeViz_Collection("__cv_uri");var g=null;var c=i["http://purl.org/linked-data/cube#measure"];e.addList(j);e._.sort(function(k,l){g=DataCube_Observation.parseValue(k,c);d=DataCube_Observation.parseValue(l,c);return g<d?h:f});return e.toObject()};return b})(CubeViz_View_Abstract);var View_IndexAction_Visualization=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_IndexAction_Visualization",c,d);this.bindGlobalEvents([{name:"onChange_visualizationClass",handler:this.onChange_visualizationClass},{name:"onReRender_visualization",handler:this.onReRender_visualization},{name:"onStart_application",handler:this.onStart_application}])}a.prototype.destroy=function(){b.prototype.destroy.call(this);return this};a.prototype.handleException=function(c){this.setVisualizationHeight();if(true===_.str.include(c,"Highcharts error #10")){$("#cubeviz-index-visualization").html($("#cubeviz-visualization-tpl-notificationHightchartsException10").html())}else{if(true===_.str.include(c,"CubeViz error no observations retrieved")){$("#cubeviz-index-visualization").html($("#cubeviz-visualization-tpl-nothingFoundNotification").text());this.triggerGlobalEvent("onReceived_noData")}else{if(true===_.str.include(c,"CubeViz error no elements to visualize")){$("#cubeviz-index-visualization").html("CubeViz error no elements to visualize");this.triggerGlobalEvent("onVisualize_noElements")}}}if(false===_.isUndefined(console)&&false===_.isUndefined(console.log)){console.log(c)}};a.prototype.initialize=function(){this.render()};a.prototype.onChange_visualizationClass=function(){this.render()};a.prototype.onClick_nothingFoundNotificationLink=function(c){$("#cubeviz-visualization-nothingFoundFurtherExplanation").slideDown("slow")};a.prototype.onReRender_visualization=function(){this.render()};a.prototype.onStart_application=function(){this.initialize()};a.prototype.render=function(){if(0==_.size(this.app._.data.retrievedObservations)){this.handleException("CubeViz error no observations retrieved");return this}var c=null;if((false===_.isNull(this.app._.data.selectedComponents.attribute)&&false===_.isUndefined(this.app._.data.selectedComponents.attribute))){if(false===this.app._.data.selectedComponents.attribute.__cv_inUse){}else{c=this.app._.data.selectedComponents.attribute["http://purl.org/linked-data/cube#attribute"]}}var h=null;var d=CubeViz_Visualization_Controller.getFromChartConfigByClass(this.app._.ui.visualization.className,this.app._.backend.chartConfig[this.app._.data.numberOfMultipleDimensions].charts);var j=null;var f=this.app._.data.selectedComponents.measure;var i=null;var k=null;if(true===_.isNull(d)){var e=CubeViz_Visualization_Controller.getDefaultChartConfig(this.app._.backend.chartConfig,this.app._.data.numberOfMultipleDimensions);this.app._.ui.visualization.className=e.className;d=e.chartConfig}k=CubeViz_Visualization_Controller.updateVisualizationSettings([],this.app._.ui.visualizationSettings[this.app._.ui.visualization.className],d.defaultConfig);i=CubeViz_Visualization_Controller.getVisualizationType(this.app._.ui.visualization.className);switch(i){case"HighCharts":if(false===_.isUndefined(this.app._.generatedVisualization)){try{this.app._.generatedVisualization.destroy()}catch(g){if(false===_.isUndefined(console)&&false===_.isUndefined(console.log)){console.log(g)}}}j=new CubeViz_Visualization_HighCharts();h=j.load(this.app._.ui.visualization.className);break;case"D3js":this.app._.generatedVisualization=null;$("#cubeviz-index-visualization").html("");j=new CubeViz_Visualization_D3js();h=j.load(this.app._.ui.visualization.className);break;default:break}h.init(k,this.app._.data.retrievedObservations,this.app._.data.selectedComponents.dimensions,CubeViz_Visualization_Controller.getMultipleDimensions(this.app._.data.selectedComponents.dimensions),CubeViz_Visualization_Controller.getOneElementDimensions(this.app._.data.selectedComponents.dimensions),f,c);try{switch(i){case"HighCharts":this.setVisualizationHeight(_.size(h.getRenderResult().xAxis.categories));if(0==_.size(h.getRenderResult().series)){this.handleException("CubeViz error no elements to visualize");return this}break}this.app._.generatedVisualization=j.render(h)}catch(g){this.handleException(g)}return this};a.prototype.setVisualizationHeight=function(c){if(typeof c==="undefined"){c=0}var f=$(this.attachedTo).offset();var e=$(window).height()-f.top-105;var d=0;if(0<c){d=c*40;if(d>e){e=d}}$(this.attachedTo).css("height",e)};return a})(CubeViz_View_Abstract);var View_IndexAction_VisualizationSelector=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_IndexAction_VisualizationSelector",c,d);this.bindGlobalEvents([{name:"onClick_setupComponentOpener",handler:this.onClick_setupComponentOpener},{name:"onReceived_noData",handler:this.onReceived_noData},{name:"onReRender_visualization",handler:this.onReRender_visualization},{name:"onStart_application",handler:this.onStart_application},{name:"onVisualize_noElements",handler:this.onVisualize_noElements}])}a.prototype.destroy=function(){b.prototype.destroy.call(this);$("#cubeviz-visualizationselector-selector").empty();this.hideDongle();this.hideMenu();return this};a.prototype.hideDongle=function(){$("#cubeviz-visualizationselector-menuDongleDiv").fadeOut("slow");return this};a.prototype.hideMenu=function(){this.triggerGlobalEvent("onBeforeHide_visualizationSelectorMenu");$("#cubeviz-visualizationselector-menu").fadeOut("slow");$("#cubeviz-visualizationselector-menuItems").html("");this.triggerGlobalEvent("onAfterHide_visualizationSelectorMenu");return this};a.prototype.initialize=function(){this.render()};a.prototype.onClick_setupComponentOpener=function(){this.hideMenu()};a.prototype.onClick_closeMenu=function(){this.hideMenu()};a.prototype.onClick_selectorItem=function(e){this.triggerGlobalEvent("onBeforeClick_selectorItem");var f="";var c=null;var d=this;if(true===_.isUndefined($(e.target).data("class"))){c=$($(e.target).parent());this.app._.ui.visualization.className=c.data("class")}else{c=$(e.target);this.app._.ui.visualization.className=c.data("class")}f=$($(".cubeviz-visualizationselector-selectedSelectorItem").get(0)).data("class");this.hideDongle();if(f==this.app._.ui.visualization.className){this.showMenu(c)}else{this.hideMenu();$(".cubeviz-visualizationselector-selectedSelectorItem").removeClass("cubeviz-visualizationselector-selectedSelectorItem").addClass("cubeviz-visualizationselector-selectorItem");c.removeClass("cubeviz-visualizationselector-selectorItem").addClass("cubeviz-visualizationselector-selectedSelectorItem");this.showMenuDongle(c);this.triggerGlobalEvent("onChange_visualizationClass");this.app._.backend.uiHash=CryptoJS.MD5(JSON.stringify(this.app._.ui))+"";CubeViz_ConfigurationLink.saveUI(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.backend.uiHash,this.app._.ui,function(){d.triggerGlobalEvent("onAfterClick_selectorItem")})}};a.prototype.onClick_updateVisz=function(){var d=CubeViz_Visualization_Controller.getFromChartConfigByClass(this.app._.ui.visualization.className,this.app._.backend.chartConfig[this.app._.data.numberOfMultipleDimensions].charts);var c=this;this.app._.ui.visualizationSettings[this.app._.ui.visualization.className]=CubeViz_Visualization_Controller.updateVisualizationSettings($(".cubeviz-visualizationselector-menuItemValue"),this.app._.ui.visualizationSettings[this.app._.ui.visualization.className],d.defaultConfig);this.app._.backend.uiHash=JSON.stringify(this.app._.ui);CubeViz_ConfigurationLink.saveUI(this.app._.backend.url,this.app._.backend.serviceUrl,this.app._.backend.modelUrl,this.app._.backend.uiHash,this.app._.ui,function(){c.triggerGlobalEvent("onReRender_visualization")})};a.prototype.onReceived_noData=function(){this.hideDongle()};a.prototype.onReRender_visualization=function(){this.destroy();if(0<_.size(this.app._.data.retrievedObservations)){this.initialize()}};a.prototype.onStart_application=function(){if(0<_.size(this.app._.data.retrievedObservations)){this.initialize()}};a.prototype.onVisualize_noElements=function(){this.hideDongle().hideMenu()};a.prototype.render=function(){this.triggerGlobalEvent("onBeforeRender_visualizationSelector");var g=this.app._.data.numberOfMultipleDimensions;var f=this.app._.backend.chartConfig[g].charts;var c;var d=this;var e;this.hideDongle();_.each(f,function(h){e=$(CubeViz_View_Helper.tplReplace($("#cubeviz-visualizationselector-tpl-selectorItem").html()));$(e.find(".cubeviz-icon-small").first()).attr("src",d.app._.backend.imagesPath+h.icon);e.data("class",h.className);e.off("click");e.on("click",$.proxy(d.onClick_selectorItem,d));if(d.app._.ui.visualization.className==h.className){e.addClass("cubeviz-visualizationselector-selectedSelectorItem").removeClass("cubeviz-visualizationselector-selectorItem")}$("#cubeviz-visualizationselector-selector").append(e)});this.showMenuDongle($($("#cubeviz-visualizationselector-selector").find(".cubeviz-visualizationselector-selectedSelectorItem").first()));this.bindUserInterfaceEvents({});this.triggerGlobalEvent("onAfterRender_visualizationSelector");return this};a.prototype.showMenu=function(f){this.triggerGlobalEvent("onBeforeShow_visualizationSelectorMenu");var k=false;var i="";var e=CubeViz_Visualization_Controller.getFromChartConfigByClass(this.app._.ui.visualization.className,this.app._.backend.chartConfig[this.app._.data.numberOfMultipleDimensions].charts);var c;var j=$("#cubeviz-visualizationselector-menuItems").html();var g=f.position();var l;var h=this.app._.ui.visualizationSettings[this.app._.ui.visualization.className];var d;if(false===_.isUndefined(e.options)&&0<_.size(e.options)&&(""==j||null==j)){_.each(e.options,function(m){k=false;c=$(CubeViz_View_Helper.tplReplace($("#cubeviz-visualizationselector-tpl-menuItem").html(),m));l=$(c.find(".cubeviz-visualizationselector-menuSelectbox").get(0));i=CubeViz_Visualization_Controller.getObjectValueByKeyString(m.key,h);d=$("<option/>");l.data("key",m.key);if(false==_.isUndefined(i)){_.each(m.values,function(n){n.value=n.value.toString();if(i.toString()==n.value&&false==k){d=$("<option/>");d.text(n.label).val(n.value).attr("selected","selected");l.append(d);k=true}})}_.each(m.values,function(n){n.value=n.value.toString();if(false==_.isUndefined(i)&&i.toString()==n.value){return}d=$("<option/>");d.text(n.label).val(n.value);if(false===k&&false===_.isUndefined(n.isDefault)&&true===n.isDefault){d.attr("selected","selected");k=true}l.append(d)});$("#cubeviz-visualizationselector-menuItems").append(c)});$("#cubeviz-visualizationselector-closeMenu").off("click");$("#cubeviz-visualizationselector-closeMenu").on("click",$.proxy(this.onClick_closeMenu,this));$("#cubeviz-visualizationselector-updateVisz").off("click");$("#cubeviz-visualizationselector-updateVisz").on("click",$.proxy(this.onClick_updateVisz,this));$("#cubeviz-visualizationselector-menu").css("top",g.top+37).css("left",g.left-192).fadeIn("slow")}this.triggerGlobalEvent("onAfterShow_visualizationSelectorMenu")};a.prototype.showMenuDongle=function(d){var f=this.app._.backend.chartConfig[this.app._.data.numberOfMultipleDimensions].charts;var e=CubeViz_Visualization_Controller.getFromChartConfigByClass(this.app._.ui.visualization.className,f);if(false===_.isUndefined(e.options)&&0<_.size(e.options)){var c=d.position();$("#cubeviz-visualizationselector-menuDongleDiv").css("top",c.top+25).css("left",c.left+14).fadeIn("slow")}};return a})(CubeViz_View_Abstract);var View_ModelinfoAction_Footer=(function(b){__extends(a,b);function a(c,d){b.call(this,"View_Modelinfo_Footer",c,d);this.bindGlobalEvents([{name:"onStart_application",handler:this.onStart_application}])}a.prototype.initialize=function(){this.render()};a.prototype.onClick_showAnalyzeBtn=function(){window.location.href=this.app._.backend.url+"analyze/"};a.prototype.onClick_showVisualizationBtn=function(){$("#cubeviz-footer-showVisualizationButton").click()};a.prototype.onStart_application=function(){this.initialize()};a.prototype.render=function(){this.bindUserInterfaceEvents({"click #cubeviz-modelinfo-showAnalyzeBtn":this.onClick_showAnalyzeBtn,"click #cubeviz-modelinfo-showVisualizationBtn":this.onClick_showVisualizationBtn});return this};return a})(CubeViz_View_Abstract);var cubeVizApp=new CubeViz_View_Application();$(document).ready(function(){if(0<_.size(cubeVizApp._)&&"development"==cubeVizApp._.backend.context){console.log("CubeViz - Development Information:");console.log(cubeVizApp._)}cubeVizApp.triggerEvent("onStart_application")});